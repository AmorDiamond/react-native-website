"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[88794],{35318:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>f});var r=n(27378);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),u=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=u(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=u(n),f=a,b=d["".concat(c,".").concat(f)]||d[f]||p[f]||o;return n?r.createElement(b,i(i({ref:t},s),{},{components:n})):r.createElement(b,i({ref:t},s))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},11674:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(63445);const a=!!r.Z.canUseDOM&&navigator.platform.startsWith("Mac"),o=!!r.Z.canUseDOM&&navigator.platform.startsWith("Win"),i={defaultGuide:"native",defaultOs:a?"macos":o?"windows":"linux",defaultPackageManager:"npm",defaultPlatform:a?"ios":"android",defaultSyntax:"functional",getDevNotesTabs:(e=["android","ios","web","windows"])=>[e.includes("android")?{label:"Android",value:"android"}:void 0,e.includes("ios")?{label:"iOS",value:"ios"}:void 0,e.includes("web")?{label:"Web",value:"web"}:void 0,e.includes("windows")?{label:"Windows",value:"windows"}:void 0].filter(Boolean),guides:[{label:"\u5b8c\u6574\u539f\u751f\u73af\u5883",value:"native"},{label:"\u7b80\u6613\u6c99\u76d2\u73af\u5883",value:"quickstart"}],oses:[{label:"macOS",value:"macos"},{label:"Windows",value:"windows"},{label:"Linux",value:"linux"}],packageManagers:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],platforms:[{label:"Android",value:"android"},{label:"iOS",value:"ios"}],syntax:[{label:"\u51fd\u6570\u5f0f\u7ec4\u4ef6",value:"functional"},{label:"Class \u7ec4\u4ef6",value:"classical"}]}},86386:(e,t,n)=>{n.d(t,{Z:()=>p});var r=n(27378),a=n(38944);const o="tabItem_wHwb";var i=Object.defineProperty,l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,s=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function p({children:e,hidden:t,className:n}){return r.createElement("div",((e,t)=>{for(var n in t||(t={}))c.call(t,n)&&s(e,n,t[n]);if(l)for(var n of l(t))u.call(t,n)&&s(e,n,t[n]);return e})({role:"tabpanel",className:(0,a.Z)(o,n)},{hidden:t}),e)}},48375:(e,t,n)=>{n.d(t,{Z:()=>_});var r=n(27378),a=n(38944),o=n(12112),i=n(35331),l=n(14953),c=n(27886),u=n(7106),s=Object.defineProperty,p=Object.defineProperties,d=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,m=(e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function h(e){return function(e){var t,n;return null!=(n=null==(t=r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:t.filter(Boolean))?n:[]}(e).map((({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r})))}function g(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=null!=t?t:h(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function y({value:e,tabValues:t}){return t.some((t=>t.value===e))}function w({queryString:e=!1,groupId:t}){const n=(0,i.k6)(),a=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:e,groupId:t});return[(0,l._X)(a),(0,r.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(n.location.search);var r,o;t.set(a,e),n.replace((r=((e,t)=>{for(var n in t||(t={}))b.call(t,n)&&m(e,n,t[n]);if(f)for(var n of f(t))v.call(t,n)&&m(e,n,t[n]);return e})({},n.location),o={search:t.toString()},p(r,d(o))))}),[a,n])]}function N(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=g(e),[i,l]=(0,r.useState)((()=>function({defaultValue:e,tabValues:t}){var n;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!y({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=null!=(n=t.find((e=>e.default)))?n:t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:o}))),[c,s]=w({queryString:n,groupId:a}),[p,d]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,a]=(0,u.Nk)(t);return[n,(0,r.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:a}),f=(()=>{const e=null!=c?c:p;return y({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{f&&l(f)}),[f]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!y({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),s(e),d(e)}),[s,d,o]),tabValues:o}}var k=n(14185);const R="tabList_J5MA",O="tabItem_l0OV";var E=Object.defineProperty,C=Object.defineProperties,A=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,S=(e,t,n)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,P=(e,t)=>{for(var n in t||(t={}))j.call(t,n)&&S(e,n,t[n]);if(T)for(var n of T(t))I.call(t,n)&&S(e,n,t[n]);return e};function x({className:e,block:t,selectedValue:n,selectValue:i,tabValues:l}){const c=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.o5)(),s=e=>{const t=e.currentTarget,r=c.indexOf(t),a=l[r].value;a!==n&&(u(t),i(a))},p=e=>{var t,n;let r=null;switch(e.key){case"Enter":s(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;r=null!=(t=c[n])?t:c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;r=null!=(n=c[t])?n:c[c.length-1];break}}null==r||r.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":t},e)},l.map((({value:e,label:t,attributes:o})=>{return r.createElement("li",(i=P({role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,key:e,ref:e=>c.push(e),onKeyDown:p,onClick:s},o),l={className:(0,a.Z)("tabs__item",O,null==o?void 0:o.className,{"tabs__item--active":n===e})},C(i,A(l))),null!=t?t:e);var i,l})))}function D({lazy:e,children:t,selectedValue:n}){const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function V(e){const t=N(e);return r.createElement("div",{className:(0,a.Z)("tabs-container",R)},r.createElement(x,P(P({},e),t)),r.createElement(D,P(P({},e),t)))}function _(e){const t=(0,k.Z)();return r.createElement(V,P({key:String(t)},e))}},44704:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>g,contentTitle:()=>m,default:()=>N,frontMatter:()=>v,metadata:()=>h,toc:()=>y});var r=n(35318),a=n(48375),o=n(86386),i=n(11674),l=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,f=(e,t,n)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,b=(e,t)=>{for(var n in t||(t={}))p.call(t,n)&&f(e,n,t[n]);if(s)for(var n of s(t))d.call(t,n)&&f(e,n,t[n]);return e};const v={id:"react-18-and-react-native",title:"React 18 \u4e0e React Native"},m=void 0,h={unversionedId:"react-18-and-react-native",id:"version-0.69/react-18-and-react-native",title:"React 18 \u4e0e React Native",description:"This page describes how to use React 18 with React Native using the React Native's New Architecture.",source:"@site/versioned_docs/version-0.69/react-18-and-react-native.md",sourceDirName:".",slug:"/react-18-and-react-native",permalink:"/docs/0.69/react-18-and-react-native",draft:!1,editUrl:"https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/react-18-and-react-native.md",tags:[],version:"0.69",frontMatter:{id:"react-18-and-react-native",title:"React 18 \u4e0e React Native"},sidebar:"docs",previous:{title:"\u5728 iOS \u4e0a\u542f\u7528 Fabric",permalink:"/docs/0.69/new-architecture-app-renderer-ios"},next:{title:"Troubleshooting",permalink:"/docs/0.69/new-architecture-troubleshooting"}},g={},y=[{value:"React 18 \u4e0e React Native \u7684\u65b0\u67b6\u6784",id:"react-18-\u4e0e-react-native-\u7684\u65b0\u67b6\u6784",level:2},{value:"React 18 \u9ed8\u8ba4\u542f\u7528",id:"react-18-\u9ed8\u8ba4\u542f\u7528",level:2},{value:"Opt-ing out of React 18 on Android",id:"opt-ing-out-of-react-18-on-android",level:3},{value:"Opt-ing out of React 18 on iOS",id:"opt-ing-out-of-react-18-on-ios",level:3},{value:"Users on React Native 0.69 not yet migrated to the New Architecture",id:"users-on-react-native-069-not-yet-migrated-to-the-new-architecture",level:3}],w={toc:y};function N(e){var t,n=e,{components:l}=n,f=((e,t)=>{var n={};for(var r in e)p.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&s)for(var r of s(e))t.indexOf(r)<0&&d.call(e,r)&&(n[r]=e[r]);return n})(n,["components"]);return(0,r.kt)("wrapper",(t=b(b({},w),f),c(t,u({components:l,mdxType:"MDXLayout"}))),(0,r.kt)("p",null,"This page describes how to use React 18 with React Native using the React Native's New Architecture."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"\u7b80\u800c\u8a00\u4e4b\uff1a")," \u7b2c\u4e00\u4e2a\u548c React 18 \u517c\u5bb9\u7684 React Native \u7248\u672c\u662f ",(0,r.kt)("strong",{parentName:"p"},"0.69.0"),". In order to use the new features in React 18 including automatic batching, ",(0,r.kt)("inlineCode",{parentName:"p"},"startTransition"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"useDeferredValue"),", you must migrate your React Native app to the New Architecture.")),(0,r.kt)("h2",b({},{id:"react-18-\u4e0e-react-native-\u7684\u65b0\u67b6\u6784"}),"React 18 \u4e0e React Native \u7684\u65b0\u67b6\u6784"),(0,r.kt)("p",null,"React 18 \u5f15\u5165\u4e86 ",(0,r.kt)("a",b({parentName:"p"},{href:"https://reactjs.org/blog/2022/03/29/react-v18.html"}),"\u591a\u4e2a\u5168\u65b0\u7279\u6027"),"\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u81ea\u52a8\u6279\u5904\u7406\u72b6\u6001\u53d8\u66f4 (Automatic batching)"),(0,r.kt)("li",{parentName:"ul"},"\u65b0\u7684\u4e25\u683c\u6a21\u5f0f (Strict Mode)"),(0,r.kt)("li",{parentName:"ul"},"\u65b0\u7684 hooks (",(0,r.kt)("inlineCode",{parentName:"li"},"useId"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"useSyncExternalStore"),")")),(0,r.kt)("p",null,"It also includes new concurrent features:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"startTransition")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"useTransition")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"useDeferredValue")),(0,r.kt)("li",{parentName:"ul"},"Full Suspense support")),(0,r.kt)("p",null,"The concurrent features in React 18 are built on top of the new concurrent rendering engine. Concurrent rendering is a new behind-the-scenes mechanism that enables React to prepare multiple versions of your UI at the same time."),(0,r.kt)("p",null,"Previous versions of React Native built on the old architecture ",(0,r.kt)("strong",{parentName:"p"},"cannot")," support concurrent rendering or concurrent features. This is because the old architecture relied on mutating the native trees, which doesn\u2019t allow for React to prepare multiple versions of the tree at the same time."),(0,r.kt)("p",null,"Fortunately, the New Architecture was written bottom-up with concurrent rendering in mind, and is fully compatible with React 18. This means, in order to upgrade to React 18 in your React Native app, your application needs to be migrated to the React Native's New Architecture including Fabric and TurboModules."),(0,r.kt)("h2",b({},{id:"react-18-\u9ed8\u8ba4\u542f\u7528"}),"React 18 \u9ed8\u8ba4\u542f\u7528"),(0,r.kt)("p",null,"Starting in React Native 0.69, React 18 is ",(0,r.kt)("strong",{parentName:"p"},"enabled by default")," when you enable the New Architecture."),(0,r.kt)("p",null,"The means you\u2019re able to use the new features in React 18 as soon as you migrate. Since the new concurrent features are opt-in by using features like ",(0,r.kt)("inlineCode",{parentName:"p"},"startTransition")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Suspense"),", we expect React 18 to work out-of-the-box with minimal changes for users who migrate to the New Architecture or create a new app with the New Architecture enabled."),(0,r.kt)("p",null,"However, if you do hit any issues, we provide an option to opt-out of the new root in React 18. Opt-ing out means your app will run in React 17 mode, and none of the features of React 18 will be accessible."),(0,r.kt)("h3",b({},{id:"opt-ing-out-of-react-18-on-android"}),"Opt-ing out of React 18 on Android"),(0,r.kt)("p",null,"On Android, you will be able to override the ",(0,r.kt)("inlineCode",{parentName:"p"},"isConcurrentRootEnabled")," in your ActivityDelegate (in the ",(0,r.kt)("inlineCode",{parentName:"p"},"MainActivity")," file), and enable/disable Concurrent React."),(0,r.kt)(a.Z,{groupId:"android-language",defaultValue:i.Z.defaultAndroidLanguage,values:i.Z.androidLanguages,mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",b({parentName:"pre"},{className:"language-diff"}),"public class MainActivity extends ReactActivity {\n\n  public static class MainActivityDelegate extends ReactActivityDelegate {\n    public MainActivityDelegate(ReactActivity activity, String mainComponentName) {\n      super(activity, mainComponentName);\n    }\n\n    @Override\n    protected ReactRootView createRootView() {\n      ReactRootView reactRootView = new ReactRootView(getContext());\n      // If you opted-in for the New Architecture, we enable the Fabric Renderer.\n      reactRootView.setIsFabric(BuildConfig.IS_NEW_ARCHITECTURE_ENABLED);\n      return reactRootView;\n    }\n\n+   @Override\n+   protected boolean isConcurrentRootEnabled() {\n+     // If you opted-in for the New Architecture, we enable Concurrent Root (i.e. React 18).\n+     // More on this on https://reactjs.org/blog/2022/03/29/react-v18.html\n+     return BuildConfig.IS_NEW_ARCHITECTURE_ENABLED;\n+   }\n  }\n}\n"))),(0,r.kt)(o.Z,{value:"kotlin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",b({parentName:"pre"},{className:"language-diff"}),"class MainActivity : ReactActivity() {\n\n    open class MainActivityDelegate(activity: ReactActivity?, mainComponentName: String?) : ReactActivityDelegate(activity, mainComponentName) {\n        override fun createRootView(): ReactRootView = ReactRootView(context).apply {\n            // If you opted-in for the New Architecture, we enable the Fabric Renderer.\n            setIsFabric(BuildConfig.IS_NEW_ARCHITECTURE_ENABLED)\n        }\n\n+       // If you opted-in for the New Architecture, we enable Concurrent Root (i.e. React 18).\n+       // More on this on https://reactjs.org/blog/2022/03/29/react-v18.html\n+       override fun isConcurrentRootEnabled() = BuildConfig.IS_NEW_ARCHITECTURE_ENABLED\n    }\n}\n")))),(0,r.kt)("h3",b({},{id:"opt-ing-out-of-react-18-on-ios"}),"Opt-ing out of React 18 on iOS"),(0,r.kt)("p",null,"On iOS, you'll have access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"concurrentRootEnabled")," method on your ",(0,r.kt)("inlineCode",{parentName:"p"},"AppDelegate.mm")," file. You should change the returned value to ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," (or ",(0,r.kt)("inlineCode",{parentName:"p"},"NO"),") to disable the feature."),(0,r.kt)("pre",null,(0,r.kt)("code",b({parentName:"pre"},{className:"language-objc"}),"/// This method controls whether the `concurrentRoot`feature of React18 is turned on or off.\n///\n/// @see: https://reactjs.org/blog/2022/03/29/react-v18.html\n/// @note: This requires to be rendering on Fabric (i.e. on the New Architecture).\n/// @return: `true` if the `concurrentRoot` feture is enabled. Otherwise, it returns `false`.\n- (BOOL)concurrentRootEnabled\n{\n  // Switch this bool to turn on and off the concurrent root\n  return true;\n}\n")),(0,r.kt)("h3",b({},{id:"users-on-react-native-069-not-yet-migrated-to-the-new-architecture"}),"Users on React Native 0.69 not yet migrated to the New Architecture"),(0,r.kt)("p",null,"Note: Users on React Native 0.69, but still on the Old Architecture will still use React 17 mode even if React 18 is installed in the ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," file."),(0,r.kt)("p",null,"Overriding the ",(0,r.kt)("inlineCode",{parentName:"p"},"isConcurrentRootEnabled")," method will have no effect on your app."))}N.isMDXComponent=!0}}]);