"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[10794],{35318:(e,a,n)=>{n.d(a,{Zo:()=>c,kt:()=>m});var t=n(27378);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=t.createContext({}),d=function(e){var a=t.useContext(u),n=a;return e&&(n="function"==typeof e?e(a):i(i({},a),e)),n},c=function(e){var a=d(e.components);return t.createElement(u.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},s=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,o=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),s=d(n),m=r,g=s["".concat(u,".").concat(m)]||s[m]||p[m]||o;return n?t.createElement(g,i(i({ref:a},c),{},{components:n})):t.createElement(g,i({ref:a},c))}));function m(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=s;var l={};for(var u in a)hasOwnProperty.call(a,u)&&(l[u]=a[u]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<o;d++)i[d]=n[d];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}s.displayName="MDXCreateElement"},11674:(e,a,n)=>{n.d(a,{Z:()=>i});var t=n(63445);const r=!!t.Z.canUseDOM&&navigator.platform.startsWith("Mac"),o=!!t.Z.canUseDOM&&navigator.platform.startsWith("Win"),i={defaultGuide:"native",defaultOs:r?"macos":o?"windows":"linux",defaultPackageManager:"npm",defaultPlatform:r?"ios":"android",defaultSyntax:"functional",getDevNotesTabs:(e=["android","ios","web","windows"])=>[e.includes("android")?{label:"Android",value:"android"}:void 0,e.includes("ios")?{label:"iOS",value:"ios"}:void 0,e.includes("web")?{label:"Web",value:"web"}:void 0,e.includes("windows")?{label:"Windows",value:"windows"}:void 0].filter(Boolean),guides:[{label:"\u5b8c\u6574\u539f\u751f\u73af\u5883",value:"native"},{label:"\u7b80\u6613\u6c99\u76d2\u73af\u5883",value:"quickstart"}],oses:[{label:"macOS",value:"macos"},{label:"Windows",value:"windows"},{label:"Linux",value:"linux"}],packageManagers:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],platforms:[{label:"Android",value:"android"},{label:"iOS",value:"ios"}],syntax:[{label:"\u51fd\u6570\u5f0f\u7ec4\u4ef6",value:"functional"},{label:"Class \u7ec4\u4ef6",value:"classical"}]}},86386:(e,a,n)=>{n.d(a,{Z:()=>p});var t=n(27378),r=n(38944);const o="tabItem_wHwb";var i=Object.defineProperty,l=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(e,a,n)=>a in e?i(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n;function p({children:e,hidden:a,className:n}){return t.createElement("div",((e,a)=>{for(var n in a||(a={}))u.call(a,n)&&c(e,n,a[n]);if(l)for(var n of l(a))d.call(a,n)&&c(e,n,a[n]);return e})({role:"tabpanel",className:(0,r.Z)(o,n)},{hidden:a}),e)}},48375:(e,a,n)=>{n.d(a,{Z:()=>S});var t=n(27378),r=n(38944),o=n(12112),i=n(35331),l=n(14953),u=n(27886),d=n(7106),c=Object.defineProperty,p=Object.defineProperties,s=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,v=(e,a,n)=>a in e?c(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n;function f(e){return function(e){return t.Children.map(e,(e=>{if((0,t.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((({props:{value:e,label:a,attributes:n,default:t}})=>({value:e,label:a,attributes:n,default:t})))}function h(e){const{values:a,children:n}=e;return(0,t.useMemo)((()=>{const e=null!=a?a:f(n);return function(e){const a=(0,u.l)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,n])}function k({value:e,tabValues:a}){return a.some((a=>a.value===e))}function y({queryString:e=!1,groupId:a}){const n=(0,i.k6)(),r=function({queryString:e=!1,groupId:a}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:e,groupId:a});return[(0,l._X)(r),(0,t.useCallback)((e=>{if(!r)return;const a=new URLSearchParams(n.location.search);var t,o;a.set(r,e),n.replace((t=((e,a)=>{for(var n in a||(a={}))g.call(a,n)&&v(e,n,a[n]);if(m)for(var n of m(a))b.call(a,n)&&v(e,n,a[n]);return e})({},n.location),o={search:a.toString()},p(t,s(o))))}),[r,n])]}function M(e){const{defaultValue:a,queryString:n=!1,groupId:r}=e,o=h(e),[i,l]=(0,t.useState)((()=>function({defaultValue:e,tabValues:a}){var n;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!k({value:e,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=null!=(n=a.find((e=>e.default)))?n:a[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:a,tabValues:o}))),[u,c]=y({queryString:n,groupId:r}),[p,s]=function({groupId:e}){const a=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,r]=(0,d.Nk)(a);return[n,(0,t.useCallback)((e=>{a&&r.set(e)}),[a,r])]}({groupId:r}),m=(()=>{const e=null!=u?u:p;return k({value:e,tabValues:o})?e:null})();(0,t.useLayoutEffect)((()=>{m&&l(m)}),[m]);return{selectedValue:i,selectValue:(0,t.useCallback)((e=>{if(!k({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),c(e),s(e)}),[c,s,o]),tabValues:o}}var N=n(14185);const T="tabList_J5MA",A="tabItem_l0OV";var w=Object.defineProperty,D=Object.defineProperties,O=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,_=(e,a,n)=>a in e?w(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,L=(e,a)=>{for(var n in a||(a={}))C.call(a,n)&&_(e,n,a[n]);if(R)for(var n of R(a))P.call(a,n)&&_(e,n,a[n]);return e};function I({className:e,block:a,selectedValue:n,selectValue:i,tabValues:l}){const u=[],{blockElementScrollPositionUntilNextRender:d}=(0,o.o5)(),c=e=>{const a=e.currentTarget,t=u.indexOf(a),r=l[t].value;r!==n&&(d(a),i(r))},p=e=>{var a,n;let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=u.indexOf(e.currentTarget)+1;t=null!=(a=u[n])?a:u[0];break}case"ArrowLeft":{const a=u.indexOf(e.currentTarget)-1;t=null!=(n=u[a])?n:u[u.length-1];break}}null==t||t.focus()};return t.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":a},e)},l.map((({value:e,label:a,attributes:o})=>{return t.createElement("li",(i=L({role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,key:e,ref:e=>u.push(e),onKeyDown:p,onClick:c},o),l={className:(0,r.Z)("tabs__item",A,null==o?void 0:o.className,{"tabs__item--active":n===e})},D(i,O(l))),null!=a?a:e);var i,l})))}function j({lazy:e,children:a,selectedValue:n}){if(a=Array.isArray(a)?a:[a],e){const e=a.find((e=>e.props.value===n));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return t.createElement("div",{className:"margin-top--md"},a.map(((e,a)=>(0,t.cloneElement)(e,{key:a,hidden:e.props.value!==n}))))}function E(e){const a=M(e);return t.createElement("div",{className:(0,r.Z)("tabs-container",T)},t.createElement(I,L(L({},e),a)),t.createElement(j,L(L({},e),a)))}function S(e){const a=(0,N.Z)();return t.createElement(E,L({key:String(a)},e))}},31043:(e,a,n)=>{n.d(a,{ZP:()=>m});var t=n(35318),r=Object.defineProperty,o=Object.defineProperties,i=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(e,a,n)=>a in e?r(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,p=(e,a)=>{for(var n in a||(a={}))u.call(a,n)&&c(e,n,a[n]);if(l)for(var n of l(a))d.call(a,n)&&c(e,n,a[n]);return e};const s={toc:[]};function m(e){var a,n=e,{components:r}=n,c=((e,a)=>{var n={};for(var t in e)u.call(e,t)&&a.indexOf(t)<0&&(n[t]=e[t]);if(null!=e&&l)for(var t of l(e))a.indexOf(t)<0&&d.call(e,t)&&(n[t]=e[t]);return n})(n,["components"]);return(0,t.kt)("wrapper",(a=p(p({},s),c),o(a,i({components:r,mdxType:"MDXLayout"}))),(0,t.kt)("admonition",p({},{title:"\u6ce8\u610f",type:"caution"}),(0,t.kt)("p",{parentName:"admonition"},"\u8fd9\u4e2a\u6587\u6863\u4ecd\u7136\u662f",(0,t.kt)("strong",{parentName:"p"},"\u5b9e\u9a8c\u6027"),"\u7684\uff0c\u968f\u7740\u6211\u4eec\u7684\u8fed\u4ee3\uff0c\u7ec6\u8282\u4f1a\u6709\u53d8\u5316\u3002\u6b22\u8fce\u5728",(0,t.kt)("a",p({parentName:"p"},{href:"https://github.com/reactwg/react-native-new-architecture/discussions/8"}),"\u5de5\u4f5c\u5c0f\u7ec4\u5185\u7684\u8ba8\u8bba"),"\u4e2d\u5206\u4eab\u4f60\u7684\u53cd\u9988\u3002"),(0,t.kt)("p",{parentName:"admonition"},"\u6b64\u5916\uff0c\u5b83\u8fd8\u5305\u542b\u51e0\u4e2a",(0,t.kt)("strong",{parentName:"p"},"\u624b\u52a8\u6b65\u9aa4"),"\u3002\u8bf7\u6ce8\u610f\u65b0\u67b6\u6784\u5c1a\u672a\u7a33\u5b9a\u4e0b\u6765\uff0c\u6700\u7ec8\u7684\u5f00\u53d1\u8005\u4f53\u9a8c\u4f1a\u7ee7\u7eed\u8fed\u4ee3\u6539\u5584\u3002\u6211\u4eec\u6b63\u5728\u52aa\u529b\u5f00\u53d1\u5de5\u5177\u3001\u6a21\u677f\u548c\u5e93\uff0c\u4ee5\u5e2e\u52a9\u4f60\u5728\u65b0\u67b6\u6784\u4e0a\u5feb\u901f\u5165\u95e8\uff0c\u800c\u4e0d\u9700\u8981\u7ecf\u5386\u6574\u4e2a\u8bbe\u7f6e\u8fc7\u7a0b\u3002")))}m.isMDXComponent=!0},93072:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>k,contentTitle:()=>f,default:()=>N,frontMatter:()=>v,metadata:()=>h,toc:()=>y});var t=n(35318),r=n(31043),o=n(48375),i=n(86386),l=n(11674),u=Object.defineProperty,d=Object.defineProperties,c=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,g=(e,a,n)=>a in e?u(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,b=(e,a)=>{for(var n in a||(a={}))s.call(a,n)&&g(e,n,a[n]);if(p)for(var n of p(a))m.call(a,n)&&g(e,n,a[n]);return e};const v={id:"new-architecture-app-modules-android",title:"\u5728 Android \u4e0a\u542f\u7528 TurboModule"},f=void 0,h={unversionedId:"new-architecture-app-modules-android",id:"version-0.71/new-architecture-app-modules-android",title:"\u5728 Android \u4e0a\u542f\u7528 TurboModule",description:"Make sure your application meets all the prerequisites.",source:"@site/versioned_docs/version-0.71/new-architecture-app-modules-android.md",sourceDirName:".",slug:"/new-architecture-app-modules-android",permalink:"/docs/0.71/new-architecture-app-modules-android",draft:!1,editUrl:"https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/new-architecture-app-modules-android.md",tags:[],version:"0.71",frontMatter:{id:"new-architecture-app-modules-android",title:"\u5728 Android \u4e0a\u542f\u7528 TurboModule"},sidebar:"docs",previous:{title:"\u5728\u5e94\u7528\u4e2d\u542f\u7528\u7684\u9884\u5907\u5de5\u4f5c",permalink:"/docs/0.71/new-architecture-app-intro"},next:{title:"\u5728 iOS \u4e0a\u542f\u7528 TurboModule",permalink:"/docs/0.71/new-architecture-app-modules-ios"}},k={},y=[{value:"1. Enable NDK and the native build",id:"1-enable-ndk-and-the-native-build",level:2},{value:"2. Java/Kotlin - Provide a <code>ReactPackageTurboModuleManagerDelegate</code>",id:"2-javakotlin---provide-a-reactpackageturbomodulemanagerdelegate",level:2},{value:"3. Adapt your <code>ReactNativeHost</code> to use the <code>ReactPackageTurboModuleManagerDelegate</code>",id:"3-adapt-your-reactnativehost-to-use-the-reactpackageturbomodulemanagerdelegate",level:2},{value:"4. Extend the <code>getPackages()</code> from your <code>ReactNativeHost</code> to use the TurboModule",id:"4-extend-the-getpackages-from-your-reactnativehost-to-use-the-turbomodule",level:2},{value:"5. C++ Provide a native implementation for the methods in your <code>*TurboModuleDelegate</code> class",id:"5-c-provide-a-native-implementation-for-the-methods-in-your-turbomoduledelegate-class",level:2},{value:"MyApplicationTurboModuleManagerDelegate.h",id:"myapplicationturbomodulemanagerdelegateh",level:4},{value:"MyApplicationTurboModuleManagerDelegate.cpp",id:"myapplicationturbomodulemanagerdelegatecpp",level:4},{value:"MyApplicationModuleProvider.h",id:"myapplicationmoduleproviderh",level:4},{value:"MyApplicationModuleProvider.cpp",id:"myapplicationmoduleprovidercpp",level:4},{value:"OnLoad.cpp",id:"onloadcpp",level:4},{value:"6. Enable the <code>useTurboModules</code> flag in your Application <code>onCreate</code>",id:"6-enable-the-useturbomodules-flag-in-your-application-oncreate",level:2}],M={toc:y};function N(e){var a,n=e,{components:u}=n,g=((e,a)=>{var n={};for(var t in e)s.call(e,t)&&a.indexOf(t)<0&&(n[t]=e[t]);if(null!=e&&p)for(var t of p(e))a.indexOf(t)<0&&m.call(e,t)&&(n[t]=e[t]);return n})(n,["components"]);return(0,t.kt)("wrapper",(a=b(b({},M),g),d(a,c({components:u,mdxType:"MDXLayout"}))),(0,t.kt)(r.ZP,{mdxType:"NewArchitectureWarning"}),(0,t.kt)("p",null,"Make sure your application meets all the ",(0,t.kt)("a",b({parentName:"p"},{href:"new-architecture-app-intro"}),"prerequisites"),"."),(0,t.kt)("h2",b({},{id:"1-enable-ndk-and-the-native-build"}),"1. Enable NDK and the native build"),(0,t.kt)("admonition",b({},{title:"\u6ce8\u610f",type:"caution"}),(0,t.kt)("p",{parentName:"admonition"},"In this iteration of the guide we\u2019re setting up the project to let you build from source. You might notice an increase in your build time because of this.\nYou can mitigate this by following the approach described in ",(0,t.kt)("a",b({parentName:"p"},{href:"/docs/next/build-speed"}),"Speeding up your Build phase")," guide.")),(0,t.kt)("p",null,"The Codegen will output some Java and some C++ code that now we need to build."),(0,t.kt)("p",null,"Let\u2019s edit your ",(0,t.kt)("strong",{parentName:"p"},"module-level")," ",(0,t.kt)("inlineCode",{parentName:"p"},"build.gradle")," to include the ",(0,t.kt)("strong",{parentName:"p"},"two")," ",(0,t.kt)("inlineCode",{parentName:"p"},"externalNativeBuild")," blocks detailed below inside the ",(0,t.kt)("inlineCode",{parentName:"p"},"android{}")," block:"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-groovy"}),'android {\n    defaultConfig {\n        applicationId "com.awesomeproject"\n        // ...\n\n        // Add this block\n        externalNativeBuild {\n            ndkBuild {\n                arguments "APP_PLATFORM=android-21",\n                        "APP_STL=c++_shared",\n                        "NDK_TOOLCHAIN_VERSION=clang",\n                        "GENERATED_SRC_DIR=$buildDir/generated/source",\n                        "PROJECT_BUILD_DIR=$buildDir",\n                        "REACT_ANDROID_DIR=$rootDir/../node_modules/react-native/ReactAndroid",\n                        "REACT_ANDROID_BUILD_DIR=$rootDir/../node_modules/react-native/ReactAndroid/build",\n                        "NODE_MODULES_DIR=$rootDir/../node_modules"\n                cFlags "-Wall", "-Werror", "-fexceptions", "-frtti", "-DWITH_INSPECTOR=1"\n                cppFlags "-std=c++17"\n                targets "myapplication_appmodules"\n                // Fix for windows limit on number of character in file paths and in command lines\n                if (Os.isFamily(Os.FAMILY_WINDOWS)) {\n                    arguments "NDK_APP_SHORT_COMMANDS=true"\n                }\n            }\n        }\n    }\n\n    // Add this block\n    externalNativeBuild {\n        ndkBuild {\n            path "$projectDir/src/main/jni/Android.mk"\n        }\n    }\n}\n')),(0,t.kt)("p",null,"In the same ",(0,t.kt)("inlineCode",{parentName:"p"},"build.gradle")," file, inside the same ",(0,t.kt)("inlineCode",{parentName:"p"},"android{}")," let\u2019s add also the following section:"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-groovy"}),'android {\n    // ...\n\n    def reactAndroidProjectDir = project(\':ReactAndroid\').projectDir\n    def packageReactNdkLibs = tasks.register("packageReactNdkLibs", Copy) {\n        dependsOn(":ReactAndroid:packageReactNdkLibsForBuck")\n        dependsOn("generateCodegenArtifactsFromSchema")\n        from("$reactAndroidProjectDir/src/main/jni/prebuilt/lib")\n        into("$buildDir/react-ndk/exported")\n    }\n\n    afterEvaluate {\n        preBuild.dependsOn(packageReactNdkLibs)\n        configureNdkBuildDebug.dependsOn(preBuild)\n        configureNdkBuildRelease.dependsOn(preBuild)\n    }\n\n    packagingOptions {\n        pickFirst \'**/libhermes.so\'\n        pickFirst \'**/libjsc.so\'\n    }\n}\n')),(0,t.kt)("p",null,"Finally, we need to create a Makefile inside the ",(0,t.kt)("inlineCode",{parentName:"p"},"src/main/jni")," folder called ",(0,t.kt)("inlineCode",{parentName:"p"},"Android.mk")," with the following content:"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-makefile"}),'THIS_DIR := $(call my-dir)\n\ninclude $(REACT_ANDROID_DIR)/Android-prebuilt.mk\n\n# If you wish to add a custom TurboModule or Fabric component in your app you\n# will have to include the following autogenerated makefile.\n# include $(GENERATED_SRC_DIR)/codegen/jni/Android.mk\n\n# Includes the MK file for autolinked libraries\ninclude $(PROJECT_BUILD_DIR)/generated/rncli/src/main/jni/Android-rncli.mk\n\ninclude $(CLEAR_VARS)\n\nLOCAL_PATH := $(THIS_DIR)\n\n# You can customize the name of your application .so file here.\nLOCAL_MODULE := awesomeapp_appmodules\n\nLOCAL_C_INCLUDES := $(LOCAL_PATH) $(PROJECT_BUILD_DIR)/generated/rncli/src/main/jni\nLOCAL_SRC_FILES := $(wildcard $(LOCAL_PATH)/*.cpp) $(wildcard $(PROJECT_BUILD_DIR)/generated/rncli/src/main/jni/*.cpp)\nLOCAL_EXPORT_C_INCLUDES := $(LOCAL_PATH) $(PROJECT_BUILD_DIR)/generated/rncli/src/main/jni\n\n# If you wish to add a custom TurboModule or Fabric component in your app you\n# will have to uncomment those lines to include the generated source\n# files from the codegen (placed in $(GENERATED_SRC_DIR)/codegen/jni)\n#\n# LOCAL_C_INCLUDES += $(GENERATED_SRC_DIR)/codegen/jni\n# LOCAL_SRC_FILES += $(wildcard $(GENERATED_SRC_DIR)/codegen/jni/*.cpp)\n# LOCAL_EXPORT_C_INCLUDES += $(GENERATED_SRC_DIR)/codegen/jni\n\n# Here you should add any native library you wish to depend on.\nLOCAL_SHARED_LIBRARIES := \\\nlibfabricjni \\\nlibfbjni \\\nlibfolly_runtime \\\nlibglog \\\nlibjsi \\\nlibreact_codegen_rncore \\\nlibreact_debug \\\nlibreact_nativemodule_core \\\nlibreact_render_componentregistry \\\nlibreact_render_core \\\nlibreact_render_debug \\\nlibreact_render_graphics \\\nlibrrc_view \\\nlibruntimeexecutor \\\nlibturbomodulejsijni \\\nlibyoga\n\n# Autolinked libraries\nLOCAL_SHARED_LIBRARIES += $(call import-codegen-modules)\n\nLOCAL_CFLAGS := -DLOG_TAG=\\"ReactNative\\" -fexceptions -frtti -std=c++17\n\ninclude $(BUILD_SHARED_LIBRARY)\n')),(0,t.kt)("p",null,"This setup will run a native build on your project and will compile the C++ files that have been generated by the codegen. You will see the native build running with the Gradle task ",(0,t.kt)("inlineCode",{parentName:"p"},":app:externalNativeBuildDebug")),(0,t.kt)("p",null,"You can now verify that everything works correctly by running your android app:"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-bash"}),"yarn react-native run-android\n")),(0,t.kt)("h2",b({},{id:"2-javakotlin---provide-a-reactpackageturbomodulemanagerdelegate"}),"2. Java/Kotlin - Provide a ",(0,t.kt)("inlineCode",{parentName:"h2"},"ReactPackageTurboModuleManagerDelegate")),(0,t.kt)("p",null,"Now is time to actually use the TurboModule.\nFirst, we will need to create a ",(0,t.kt)("inlineCode",{parentName:"p"},"ReactPackageTurboModuleManagerDelegate")," subclass, like the following:"),(0,t.kt)(o.Z,{groupId:"android-language",defaultValue:l.Z.defaultAndroidLanguage,values:l.Z.androidLanguages,mdxType:"Tabs"},(0,t.kt)(i.Z,{value:"java",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-java"}),'package com.awesomeproject;\n\nimport com.facebook.jni.HybridData;\nimport com.facebook.react.ReactPackage;\nimport com.facebook.react.ReactPackageTurboModuleManagerDelegate;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.soloader.SoLoader;\n\nimport java.util.List;\n\npublic class MyApplicationTurboModuleManagerDelegate extends ReactPackageTurboModuleManagerDelegate {\n\n    private static volatile boolean sIsSoLibraryLoaded;\n\n    protected MyApplicationTurboModuleManagerDelegate(ReactApplicationContext reactApplicationContext, List<ReactPackage> packages) {\n        super(reactApplicationContext, packages);\n    }\n\n    protected native HybridData initHybrid();\n\n    public static class Builder extends ReactPackageTurboModuleManagerDelegate.Builder {\n        protected MyApplicationTurboModuleManagerDelegate build(\n                ReactApplicationContext context, List<ReactPackage> packages) {\n            return new MyApplicationTurboModuleManagerDelegate(context, packages);\n        }\n    }\n\n    @Override\n    protected synchronized void maybeLoadOtherSoLibraries() {\n        // Prevents issues with initializer interruptions.\n        if (!sIsSoLibraryLoaded) {\n            SoLoader.loadLibrary("myapplication_appmodules");\n            sIsSoLibraryLoaded = true;\n        }\n    }\n}\n'))),(0,t.kt)(i.Z,{value:"kotlin",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-kotlin"}),'package com.awesomeproject\n\nimport com.facebook.jni.HybridData\nimport com.facebook.react.ReactPackage\nimport com.facebook.react.ReactPackageTurboModuleManagerDelegate\nimport com.facebook.react.bridge.ReactApplicationContext\nimport com.facebook.soloader.SoLoader\n\nclass MyApplicationTurboModuleManagerDelegate\nprotected constructor(\n    reactApplicationContext: ReactApplicationContext,\n    packages: List<ReactPackage>\n) : ReactPackageTurboModuleManagerDelegate(reactApplicationContext, packages) {\n\n    override protected external fun initHybrid(): HybridData?\n    class Builder : ReactPackageTurboModuleManagerDelegate.Builder() {\n        override protected fun build(\n            context: ReactApplicationContext,\n            packages: List<ReactPackage>\n        ): MyApplicationTurboModuleManagerDelegate =\n            MyApplicationTurboModuleManagerDelegate(context, packages)\n    }\n\n    @Synchronized\n    override protected fun maybeLoadOtherSoLibraries() {\n        // Prevents issues with initializer interruptions.\n        if (!isSoLibraryLoaded) {\n            SoLoader.loadLibrary("myapplication_appmodules")\n            isSoLibraryLoaded = true\n        }\n    }\n\n    companion object {\n        @Volatile private var isSoLibraryLoaded = false\n    }\n}\n')))),(0,t.kt)("p",null,"Please note that the ",(0,t.kt)("inlineCode",{parentName:"p"},"SoLoader.loadLibrary")," parameter (in this case ",(0,t.kt)("inlineCode",{parentName:"p"},'"myapplication_appmodules")')," should be the same as the one specified for ",(0,t.kt)("inlineCode",{parentName:"p"},"LOCAL_MODULE :=")," inside the ",(0,t.kt)("inlineCode",{parentName:"p"},"Android.mk")," file you created before."),(0,t.kt)("p",null,"This class will then be responsible of loading the TurboModules and will take care of loading the native library build with the NDK at runtime."),(0,t.kt)("h2",b({},{id:"3-adapt-your-reactnativehost-to-use-the-reactpackageturbomodulemanagerdelegate"}),"3. Adapt your ",(0,t.kt)("inlineCode",{parentName:"h2"},"ReactNativeHost")," to use the ",(0,t.kt)("inlineCode",{parentName:"h2"},"ReactPackageTurboModuleManagerDelegate")),(0,t.kt)("p",null,"Then, you can provide the class you created to your ",(0,t.kt)("inlineCode",{parentName:"p"},"ReactNativeHost"),". You can locate your ",(0,t.kt)("inlineCode",{parentName:"p"},"ReactNativeHost")," by searching for the ",(0,t.kt)("inlineCode",{parentName:"p"},"getReactNativeHost()"),". The ",(0,t.kt)("inlineCode",{parentName:"p"},"ReactNativeHost")," is usually located inside your ",(0,t.kt)("inlineCode",{parentName:"p"},"Application")," class."),(0,t.kt)("p",null,"Once you located it, you need to add the ",(0,t.kt)("inlineCode",{parentName:"p"},"getReactPackageTurboModuleManagerDelegateBuilder")," method as from the snippet below:"),(0,t.kt)(o.Z,{groupId:"android-language",defaultValue:l.Z.defaultAndroidLanguage,values:l.Z.androidLanguages,mdxType:"Tabs"},(0,t.kt)(i.Z,{value:"java",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-java"}),"public class MyApplication extends Application implements ReactApplication {\n\n    private final ReactNativeHost mReactNativeHost =\n        new ReactNativeHost(this) {\n            @Override\n            public boolean getUseDeveloperSupport() { /* ... */ }\n\n            @Override\n            protected List<ReactPackage> getPackages() { /* ... */ }\n\n            @Override\n            protected String getJSMainModuleName() {/* ... */ }\n\n            @NonNull\n            @Override\n            protected ReactPackageTurboModuleManagerDelegate.Builder getReactPackageTurboModuleManagerDelegateBuilder() {\n                return new MyApplicationTurboModuleManagerDelegate.Builder();\n            }\n        };\n}\n"))),(0,t.kt)(i.Z,{value:"kotlin",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-kotlin"}),"class MyApplication : Application(), ReactApplication {\n    private val reactNativeHost: ReactNativeHost =\n        object : ReactNativeHost(this) {\n\n            override fun getUseDeveloperSupport(): Boolean {\n                /* ... */\n            }\n\n            override fun getPackages(): List<ReactPackage?>? {\n                /* ... */\n            }\n\n            override fun getJSMainModuleName(): String? {\n                /* ... */\n            }\n\n            @NonNull\n            override fun getReactPackageTurboModuleManagerDelegateBuilder() =\n                ReactPackageTurboModuleManagerDelegate.Builder()\n        }\n}\n")))),(0,t.kt)("h2",b({},{id:"4-extend-the-getpackages-from-your-reactnativehost-to-use-the-turbomodule"}),"4. Extend the ",(0,t.kt)("inlineCode",{parentName:"h2"},"getPackages()")," from your ",(0,t.kt)("inlineCode",{parentName:"h2"},"ReactNativeHost")," to use the TurboModule"),(0,t.kt)("p",null,"Still on the ",(0,t.kt)("inlineCode",{parentName:"p"},"ReactNativeHost")," , we need to extend the the ",(0,t.kt)("inlineCode",{parentName:"p"},"getPackages()")," method to include the newly created TurboModule. Update the method to include the following:"),(0,t.kt)(o.Z,{groupId:"android-language",defaultValue:l.Z.defaultAndroidLanguage,values:l.Z.androidLanguages,mdxType:"Tabs"},(0,t.kt)(i.Z,{value:"java",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-java"}),'public class MyApplication extends Application implements ReactApplication {\n\n    private final ReactNativeHost mReactNativeHost =\n        new ReactNativeHost(this) {\n            @Override\n            public boolean getUseDeveloperSupport() { /* ... */ }\n\n            @Override\n            protected List<ReactPackage> getPackages() {\n                List<ReactPackage> packages = new PackageList(this).getPackages();\n\n                // Add those lines\n                packages.add(new TurboReactPackage() {\n                    @Nullable\n                    @Override\n                    public NativeModule getModule(String name, ReactApplicationContext reactContext) {\n                        if (name.equals(NativeAwesomeManager.NAME)) {\n                            return new NativeAwesomeManager(reactContext);\n                        } else {\n                            return null;\n                        }\n                    }\n\n                    @Override\n                    public ReactModuleInfoProvider getReactModuleInfoProvider() {\n                        return () -> {\n                            final Map<String, ReactModuleInfo> moduleInfos = new HashMap<>();\n                            moduleInfos.put(\n                                    NativeAwesomeManager.NAME,\n                                    new ReactModuleInfo(\n                                            NativeAwesomeManager.NAME,\n                                            "NativeAwesomeManager",\n                                            false, // canOverrideExistingModule\n                                            false, // needsEagerInit\n                                            true, // hasConstants\n                                            false, // isCxxModule\n                                            true // isTurboModule\n                                    )\n                            );\n                            return moduleInfos;\n                        };\n                    }\n                });\n                return packages;\n            }\n\n            @Override\n            protected String getJSMainModuleName() {/* ... */ }\n\n            @NonNull\n            @Override\n            protected ReactPackageTurboModuleManagerDelegate.Builder getReactPackageTurboModuleManagerDelegateBuilder() {\n                return new MyApplicationTurboModuleManagerDelegate.Builder();\n            }\n        };\n}\n'))),(0,t.kt)(i.Z,{value:"kotlin",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-kotlin"}),'class MyApplication() : Application(), ReactApplication {\n\n    private val reactNativeHost: ReactNativeHost =\n        object : ReactNativeHost(this) {\n            override fun getUseDeveloperSupport(): Boolean {\n                /* ... */\n            }\n\n            override protected fun getPackages(): List<ReactPackage>? {\n                val packages: MutableList<ReactPackage> = PackageList(this).getPackages()\n\n                // Add those lines\n                packages.add(\n                    object : TurboReactPackage() {\n                        @Nullable\n                        override fun getModule(\n                            name: String,\n                            reactContext: ReactApplicationContext?\n                        ): NativeModule? =\n                            if ((name == NativeAwesomeManager.NAME)) {\n                                NativeAwesomeManager(reactContext)\n                            } else {\n                                null\n                            }\n\n                        override fun getReactModuleInfoProvider() =\n                            mutableMapOf<String, ReactModuleInfo>(\n                                NativeAwesomeManager.NAME,\n                                ReactModuleInfo(\n                                    NativeAwesomeManager.NAME,\n                                    "NativeAwesomeManager",\n                                    false, // canOverrideExistingModule\n                                    false, // needsEagerInit\n                                    true, // hasConstants\n                                    false, // isCxxModule\n                                    true // isTurboModule\n                                )\n                            )\n                    }\n                )\n                return packages\n            }\n\n            override protected fun getJSMainModuleName(): String? {\n                /* ... */\n            }\n\n            @NonNull\n            override protected fun getReactPackageTurboModuleManagerDelegateBuilder():\n                ReactPackageTurboModuleManagerDelegate.Builder? {\n                return Builder()\n            }\n        }\n}\n')))),(0,t.kt)("h2",b({},{id:"5-c-provide-a-native-implementation-for-the-methods-in-your-turbomoduledelegate-class"}),"5. C++ Provide a native implementation for the methods in your ",(0,t.kt)("inlineCode",{parentName:"h2"},"*TurboModuleDelegate")," class"),(0,t.kt)("p",null,"If you take a closer look at the class ",(0,t.kt)("inlineCode",{parentName:"p"},"MyApplicationTurboModuleManagerDelegate")," that you created before, you will notice how some of the methods are ",(0,t.kt)("inlineCode",{parentName:"p"},"native"),"."),(0,t.kt)("p",null,"Therefore, you need to provide some C++ classes to implement those methods. Specifically you will need those files, to be added inside the ",(0,t.kt)("inlineCode",{parentName:"p"},"src/main/jni")," folder:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"MyApplicationTurboModuleManagerDelegate.h")," An header file for the TurboModule Delegate."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"MyApplicationTurboModuleManagerDelegate.cpp")," The implementation of the aforementioned header file."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"MyApplicationModuleProvider.h")," A header file for the TurboModule provider, where you can specify which TurboModules you want to load."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"MyApplicationModuleProvider.cpp")," The implementation for the aforementioned header file."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"OnLoad.cpp")," Where the initialisation code will be placed. Specifically TurboModule uses FBJNI so the initialisation for such library lives there.")),(0,t.kt)("p",null,"The content of those files should be the following:"),(0,t.kt)("h4",b({},{id:"myapplicationturbomodulemanagerdelegateh"}),"MyApplicationTurboModuleManagerDelegate.h"),(0,t.kt)("p",null,"Please note that the ",(0,t.kt)("inlineCode",{parentName:"p"},"kJavaDescriptor")," should be adapted to follow the package name you picked for your project."),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-cpp"}),'#include <memory>\n#include <string>\n\n#include <ReactCommon/TurboModuleManagerDelegate.h>\n#include <fbjni/fbjni.h>\n\nnamespace facebook {\nnamespace react {\n\nclass MyApplicationTurboModuleManagerDelegate : public jni::HybridClass<MyApplicationTurboModuleManagerDelegate, TurboModuleManagerDelegate> {\npublic:\n  // Adapt it to the package you used for your Java class.\n  static constexpr auto kJavaDescriptor =\n      "Lcom/awesomeproject/MyApplicationTurboModuleManagerDelegate;";\n\n  static jni::local_ref<jhybriddata> initHybrid(jni::alias_ref<jhybridobject>);\n\n  static void registerNatives();\n\n  std::shared_ptr<TurboModule> getTurboModule(const std::string name, const std::shared_ptr<CallInvoker> jsInvoker) override;\n  std::shared_ptr<TurboModule> getTurboModule(const std::string name, const JavaTurboModule::InitParams &params) override;\n\nprivate:\n  friend HybridBase;\n  using HybridBase::HybridBase;\n\n};\n\n} // namespace react\n} // namespace facebook\n')),(0,t.kt)("h4",b({},{id:"myapplicationturbomodulemanagerdelegatecpp"}),"MyApplicationTurboModuleManagerDelegate.cpp"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-cpp"}),'#include "MyApplicationTurboModuleManagerDelegate.h"\n#include "MyApplicationModuleProvider.h"\n\nnamespace facebook {\nnamespace react {\n\njni::local_ref<MyApplicationTurboModuleManagerDelegate::jhybriddata> MyApplicationTurboModuleManagerDelegate::initHybrid(jni::alias_ref<jhybridobject>) {\n  return makeCxxInstance();\n}\n\nvoid MyApplicationTurboModuleManagerDelegate::registerNatives() {\n  registerHybrid({\n    makeNativeMethod("initHybrid", MyApplicationTurboModuleManagerDelegate::initHybrid),\n  });\n}\n\nstd::shared_ptr<TurboModule> MyApplicationTurboModuleManagerDelegate::getTurboModule(const std::string name, const std::shared_ptr<CallInvoker> jsInvoker) {\n  // Not implemented yet: provide pure-C++ NativeModules here.\n  return nullptr;\n}\n\nstd::shared_ptr<TurboModule> MyApplicationTurboModuleManagerDelegate::getTurboModule(const std::string name, const JavaTurboModule::InitParams &params) {\n  return MyApplicationModuleProvider(name, params);\n}\n\n} // namespace react\n} // namespace facebook\n')),(0,t.kt)("h4",b({},{id:"myapplicationmoduleproviderh"}),"MyApplicationModuleProvider.h"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-cpp"}),"#pragma once\n\n#include <memory>\n#include <string>\n\n#include <ReactCommon/JavaTurboModule.h>\n\nnamespace facebook {\nnamespace react {\n\nstd::shared_ptr<TurboModule> MyApplicationModuleProvider(const std::string moduleName, const JavaTurboModule::InitParams &params);\n\n} // namespace react\n} // namespace facebook\n")),(0,t.kt)("h4",b({},{id:"myapplicationmoduleprovidercpp"}),"MyApplicationModuleProvider.cpp"),(0,t.kt)("p",null,"Please adapt the ",(0,t.kt)("inlineCode",{parentName:"p"},"samplelibrary.h")," import to match the same library name you provided when building the apps.\nThis is the C++ generated file that is created by the codegen."),(0,t.kt)("p",null,"Here you can also specify more than one provider, should you have more than one TurboModule. Specifically in this example we look for a TurboModule from ",(0,t.kt)("inlineCode",{parentName:"p"},"samplelibrary")," (the one we specified) and we fallback to the ",(0,t.kt)("inlineCode",{parentName:"p"},"rncore")," Module Provider (containing all the Core modules)."),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-cpp"}),'#include "MyApplicationModuleProvider.h"\n\n#include <rncore.h>\n#include <samplelibrary.h>\n\nnamespace facebook {\nnamespace react {\n\nstd::shared_ptr<TurboModule> MyApplicationModuleProvider(const std::string moduleName, const JavaTurboModule::InitParams &params) {\n    auto module = samplelibrary_ModuleProvider(moduleName, params);\n    if (module != nullptr) {\n      return module;\n    }\n\n    return rncore_ModuleProvider(moduleName, params);\n}\n\n} // namespace react\n} // namespace facebook\n')),(0,t.kt)("h4",b({},{id:"onloadcpp"}),"OnLoad.cpp"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-cpp"}),'#include <fbjni/fbjni.h>\n#include "MyApplicationTurboModuleManagerDelegate.h"\n\nJNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void *) {\n  return facebook::jni::initialize(vm, [] {\n    facebook::react::MyApplicationTurboModuleManagerDelegate::registerNatives();\n  });\n}\n')),(0,t.kt)("h2",b({},{id:"6-enable-the-useturbomodules-flag-in-your-application-oncreate"}),"6. Enable the ",(0,t.kt)("inlineCode",{parentName:"h2"},"useTurboModules")," flag in your Application ",(0,t.kt)("inlineCode",{parentName:"h2"},"onCreate")),(0,t.kt)("p",null,"Now you can finally enable the ",(0,t.kt)("inlineCode",{parentName:"p"},"TurboModule "),"support in your Application. To do so, you need to turn on the ",(0,t.kt)("inlineCode",{parentName:"p"},"useTurboModule")," flag inside your Application ",(0,t.kt)("inlineCode",{parentName:"p"},"onCreate")," method."),(0,t.kt)(o.Z,{groupId:"android-language",defaultValue:l.Z.defaultAndroidLanguage,values:l.Z.androidLanguages,mdxType:"Tabs"},(0,t.kt)(i.Z,{value:"java",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-java"}),"public class MyApplication extends Application implements ReactApplication {\n\n    @Override\n    public void onCreate() {\n        ReactFeatureFlags.useTurboModules = true;\n        //...\n    }\n}\n"))),(0,t.kt)(i.Z,{value:"kotlin",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-kotlin"}),"class MyApplication : Application(), ReactApplication {\n\n    override fun onCreate() {\n        ReactFeatureFlags.useTurboModules = true\n        // ...\n    }\n}\n")))),(0,t.kt)("p",null,"It\u2019s now time to run again your Android app to verify that everything works correctly:"),(0,t.kt)("pre",null,(0,t.kt)("code",b({parentName:"pre"},{className:"language-bash"}),"yarn react-native run-android\n")))}N.isMDXComponent=!0}}]);