"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[20925],{35318:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(27378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,g=u["".concat(p,".").concat(m)]||u[m]||s[m]||i;return n?a.createElement(g,l(l({ref:t},c),{},{components:n})):a.createElement(g,l({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},38286:function(e,t,n){n.d(t,{ZP:function(){return m}});var a=n(35318),r=Object.defineProperty,i=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,s=(e,t)=>{for(var n in t||(t={}))p.call(t,n)&&c(e,n,t[n]);if(o)for(var n of o(t))d.call(t,n)&&c(e,n,t[n]);return e};const u={toc:[]};function m(e){var t,n=e,{components:r}=n,c=((e,t)=>{var n={};for(var a in e)p.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&o)for(var a of o(e))t.indexOf(a)<0&&d.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=s(s({},u),c),i(t,l({components:r,mdxType:"MDXLayout"}))),(0,a.kt)("div",s({},{className:"admonition admonition-caution alert alert--warning"}),(0,a.kt)("div",s({parentName:"div"},{className:"admonition-heading"}),(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",s({parentName:"h5"},{className:"admonition-icon"}),(0,a.kt)("svg",s({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),(0,a.kt)("path",s({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),(0,a.kt)("div",s({parentName:"div"},{className:"admonition-content"}),(0,a.kt)("p",{parentName:"div"},"This documentation is still ",(0,a.kt)("strong",{parentName:"p"},"experimental")," and details are subject to changes as we iterate. Feel free to share your feedback on the ",(0,a.kt)("a",s({parentName:"p"},{href:"https://github.com/reactwg/react-native-new-architecture/discussions/8"}),"discussion inside the working group")," for this page."),(0,a.kt)("p",{parentName:"div"},"Moreover, it contains several ",(0,a.kt)("strong",{parentName:"p"},"manual steps"),". Please note that this won't be representative of the final developer experience once the New Architecture is stable. We're working on tools, templates and libraries to help you get started fast on the New Architecture, without having to go through the whole setup."))))}m.isMDXComponent=!0},71131:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return m},contentTitle:function(){return g},metadata:function(){return k},toc:function(){return h},default:function(){return f}});var a=n(35318),r=n(38286),i=Object.defineProperty,l=Object.defineProperties,o=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,s=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))d.call(t,n)&&s(e,n,t[n]);if(p)for(var n of p(t))c.call(t,n)&&s(e,n,t[n]);return e};const m={id:"new-architecture-appendix",title:"Appendix"},g=void 0,k={unversionedId:"new-architecture-appendix",id:"new-architecture-appendix",title:"Appendix",description:"I. Flow Type to Native Type Mapping",source:"@site/../cndocs/new-architecture-appendix.md",sourceDirName:".",slug:"/new-architecture-appendix",permalink:"/docs/next/new-architecture-appendix",editUrl:"https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/new-architecture-appendix.md",tags:[],version:"current",frontMatter:{id:"new-architecture-appendix",title:"Appendix"}},h=[{value:"I. Flow Type to Native Type Mapping",id:"i-flow-type-to-native-type-mapping",children:[],level:2},{value:"II. Invoking the code-gen during development",id:"ii-invoking-the-code-gen-during-development",children:[{value:"Invoking a Gradle task directly",id:"invoking-a-gradle-task-directly",children:[],level:3},{value:"Invoking the script manually",id:"invoking-the-script-manually",children:[{value:"Generating the schema file",id:"generating-the-schema-file",children:[],level:4},{value:"Generating the native code artifacts",id:"generating-the-native-code-artifacts",children:[{value:"Example",id:"example",children:[],level:5}],level:4}],level:3}],level:2},{value:"III. Note on Existing Apps",id:"iii-note-on-existing-apps",children:[{value:"Finding your bridge delegate",id:"finding-your-bridge-delegate",children:[],level:3}],level:2}],N={toc:h};function f(e){var t,n=e,{components:i}=n,s=((e,t)=>{var n={};for(var a in e)d.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&p)for(var a of p(e))t.indexOf(a)<0&&c.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=u(u({},N),s),l(t,o({components:i,mdxType:"MDXLayout"}))),(0,a.kt)(r.ZP,{mdxType:"NewArchitectureWarning"}),(0,a.kt)("h2",u({},{id:"i-flow-type-to-native-type-mapping"}),"I. Flow Type to Native Type Mapping"),(0,a.kt)("p",null,"You may use the following table as a reference for which types are supported and what they map to in each platform:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",u({parentName:"tr"},{align:null}),"Flow Type"),(0,a.kt)("th",u({parentName:"tr"},{align:null}),"Nullable Support?"),(0,a.kt)("th",u({parentName:"tr"},{align:null}),"Android (Java)"),(0,a.kt)("th",u({parentName:"tr"},{align:null}),"iOS"),(0,a.kt)("th",u({parentName:"tr"},{align:null}),"Note"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"string")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"?string")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"String")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"NSString")),(0,a.kt)("td",u({parentName:"tr"},{align:null}))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"boolean")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"?boolean")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"Boolean")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"NSNumber")),(0,a.kt)("td",u({parentName:"tr"},{align:null}))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"number")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"No"),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"double")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"NSNumber")),(0,a.kt)("td",u({parentName:"tr"},{align:null}))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("code",null,"{","|"," foo: string, ... ","|","}")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("code",null,"?{","|"," foo: string, ...","|","}")),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Object literal. This is recommended over simply using Object, for type safety.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"Object")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"?Object")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"ReadableMap")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"@{} (untyped dictionary)")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Recommended to use object literal (see above).")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"Array<*>")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"?Array<*>")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"ReadableArray")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"NSArray")," (or ",(0,a.kt)("inlineCode",{parentName:"td"},"RCTConvertVecToArray")," when used inside objects)"),(0,a.kt)("td",u({parentName:"tr"},{align:null}))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"Function")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"?Function")),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null}))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"Promise<*>")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"?Promise<*>")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"com.facebook.react.bridge.Promise")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"RCTPromiseResolve")," and ",(0,a.kt)("inlineCode",{parentName:"td"},"RCTPromiseRejectBlock")),(0,a.kt)("td",u({parentName:"tr"},{align:null}))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Type aliases of the above"),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Yes"),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null}))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Type Unions ",(0,a.kt)("code",null,"'SUCCESS'","|","'FAIL'")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Only as callbacks."),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null})),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Type unions only supported as callbacks.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Callbacks: ",(0,a.kt)("inlineCode",{parentName:"td"},"( ) =>")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Yes"),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"com.facebook.react.bridge.Callback")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"RCTResponseSenderBlock")),(0,a.kt)("td",u({parentName:"tr"},{align:null}),"Callback functions are not type checked, and are generalized as Objects.")))),(0,a.kt)("p",null,"You may also find it useful to refer to the JavaScript specifications for the core modules in React Native. These are located inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"Libraries/")," directory in the React Native repository."),(0,a.kt)("h2",u({},{id:"ii-invoking-the-code-gen-during-development"}),"II. Invoking the code-gen during development"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This section contains information specific to v0.66 of React Native.")),(0,a.kt)("p",null,"The code-gen is typically invoked at build time, but you may find it useful to generate your native interface code on demand for troubleshooting."),(0,a.kt)("p",null,"If you wish to invoke the codegen manually, you have two options:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Invoking a Gradle task directly (Android)."),(0,a.kt)("li",{parentName:"ol"},"Invoking a script manually.")),(0,a.kt)("h3",u({},{id:"invoking-a-gradle-task-directly"}),"Invoking a Gradle task directly"),(0,a.kt)("p",null,"You can trigger the code-gen by invoking the following task:"),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"./gradlew generateCodegenArtifactsFromSchema --rerun-tasks\n")),(0,a.kt)("p",null,"The extra ",(0,a.kt)("inlineCode",{parentName:"p"},"--rerun-tasks")," flag is added to make sure Gradle is ignoring the ",(0,a.kt)("inlineCode",{parentName:"p"},"UP-TO-DATE")," checks for this task. You should not need it during normal development."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"generateCodegenArtifactsFromSchema")," task normally runs before the ",(0,a.kt)("inlineCode",{parentName:"p"},"preBuild")," task, so you should not need to invoke it manually, but it will be triggered before your builds."),(0,a.kt)("h3",u({},{id:"invoking-the-script-manually"}),"Invoking the script manually"),(0,a.kt)("p",null,"Alternatively, you can invoke the Codegen directly, bypassing the Gradle Plugin or CocoaPods infrastructure.\nThis can be done with the following commands."),(0,a.kt)("p",null,"The parameters to provide will look quite familiar to you now that you have already configured the Gradle plugin or CocoaPods library."),(0,a.kt)("h4",u({},{id:"generating-the-schema-file"}),"Generating the schema file"),(0,a.kt)("p",null,"First, you\u2019ll need to generate a schema file from your JavaScript sources. You only need to do this whenever your JavaScript specs change. The script to generate this schema is provided as part of the ",(0,a.kt)("inlineCode",{parentName:"p"},"react-native-codegen")," package. If running this from within your React Native application, you can use the package from ",(0,a.kt)("inlineCode",{parentName:"p"},"node_modules")," directly:"),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"node node_modules/react-native-codegen/lib/cli/combine/combine-js-to-schema-cli.js \\\n  <output_file_schema_json> <javascript_sources_dir>\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The source for the ",(0,a.kt)("inlineCode",{parentName:"p"},"react-native-codegen")," is available in the React Native repository, under ",(0,a.kt)("inlineCode",{parentName:"p"},"packages/react-native-codegen"),". Run ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn install")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn build")," in that directory to build your own ",(0,a.kt)("inlineCode",{parentName:"p"},"react-native-codegen")," package from source. In most cases, you will not want to do this as the guide assumes the use of the ",(0,a.kt)("inlineCode",{parentName:"p"},"react-native-codegen")," package version that is associated with the relevant React Native nightly release.")),(0,a.kt)("h4",u({},{id:"generating-the-native-code-artifacts"}),"Generating the native code artifacts"),(0,a.kt)("p",null,"Once you have a schema file for your native modules or components, you can use a second script to generate the actual native code artifacts for your library. You can use the same schema file generated by the previous script."),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"node node_modules/react-native/scripts/generate-specs-cli.js \\\n  --platform <ios|android> \\\n  --schemaPath <generated_schema_json_file> \\\n  --outputDir <output_dir> \\\n  [--libraryName library_name] \\\n  [--javaPackageName java_package_name] \\\n  [--libraryType all(default)|modules|components]\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"NOTE:")," The output artifacts of the code-gen are inside the build folder and should not be committed.\nThey should be considered only for reference.")),(0,a.kt)("h5",u({},{id:"example"}),"Example"),(0,a.kt)("p",null,"The following is a basic example of invoking the code-gen script to generate native iOS interface code for a library that provides native modules. The JavaScript spec sources for this library are located in a ",(0,a.kt)("inlineCode",{parentName:"p"},"js/")," subdirectory, and this library\u2019s native code expects the native interfaces to be available in the ",(0,a.kt)("inlineCode",{parentName:"p"},"ios")," subdirectory."),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"# Generate schema - only needs to be done whenever JS specs change\nnode node_modules/react-native-codegen/lib/cli/combine/combine-js-to-schema-cli.js /tmp/schema.json ./js\n\n# Generate native code artifacts\nnode node_modules/react-native/scripts/generate-specs-cli.js \\\n  --platform ios \\\n  --schemaPath /tmp/schema.json \\\n  --outputDir ./ios \\\n  --libraryName MyLibSpecs \\\n  --libraryType modules\n")),(0,a.kt)("p",null,"In the above example, the code-gen script will generate several files: ",(0,a.kt)("inlineCode",{parentName:"p"},"MyLibSpecs.h")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"MyLibSpecs-generated.mm"),", as well as a handful of ",(0,a.kt)("inlineCode",{parentName:"p"},".h")," and ",(0,a.kt)("inlineCode",{parentName:"p"},".cpp")," files, all located in the ",(0,a.kt)("inlineCode",{parentName:"p"},"ios")," directory."),(0,a.kt)("h2",u({},{id:"iii-note-on-existing-apps"}),"III. Note on Existing Apps"),(0,a.kt)("p",null,"This guide provides instructions for migrating an application that is based on the default app template that is provided by React Native. If your app has deviated from the template, or you are working with an application that was never based off the template, then the following sections might help."),(0,a.kt)("h3",u({},{id:"finding-your-bridge-delegate"}),"Finding your bridge delegate"),(0,a.kt)("p",null,"This guide assumes that the ",(0,a.kt)("inlineCode",{parentName:"p"},"AppDelegate")," is configured as the bridge delegate. If you are not sure which is your bridge delegate, then place a breakpoint in ",(0,a.kt)("inlineCode",{parentName:"p"},"RCTBridge")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"RCTCxxBridge"),", run your app, and inspect ",(0,a.kt)("inlineCode",{parentName:"p"},"self.delegate"),"."))}f.isMDXComponent=!0}}]);