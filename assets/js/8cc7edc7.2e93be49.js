/*! For license information please see 8cc7edc7.2e93be49.js.LICENSE.txt */
"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[60286],{61647:(e,n,r)=>{r.d(n,{ZP:()=>l});var t=r(24246),o=r(71670);function a(e){const n=Object.assign({admonition:"admonition",p:"p",strong:"strong",a:"a"},(0,o.ah)(),e.components);return(0,t.jsxs)(n.admonition,{title:"\u6ce8\u610f",type:"caution",children:[(0,t.jsxs)(n.p,{children:["\u8fd9\u4e2a\u6587\u6863\u4ecd\u7136\u662f",(0,t.jsx)(n.strong,{children:"\u5b9e\u9a8c\u6027"}),"\u7684\uff0c\u968f\u7740\u6211\u4eec\u7684\u8fed\u4ee3\uff0c\u7ec6\u8282\u4f1a\u6709\u53d8\u5316\u3002\u6b22\u8fce\u5728",(0,t.jsx)(n.a,{href:"https://github.com/reactwg/react-native-new-architecture/discussions/8",children:"\u5de5\u4f5c\u5c0f\u7ec4\u5185\u7684\u8ba8\u8bba"}),"\u4e2d\u5206\u4eab\u4f60\u7684\u53cd\u9988\u3002"]}),(0,t.jsxs)(n.p,{children:["\u6b64\u5916\uff0c\u5b83\u8fd8\u5305\u542b\u51e0\u4e2a",(0,t.jsx)(n.strong,{children:"\u624b\u52a8\u6b65\u9aa4"}),"\u3002\u8bf7\u6ce8\u610f\u65b0\u67b6\u6784\u5c1a\u672a\u7a33\u5b9a\u4e0b\u6765\uff0c\u6700\u7ec8\u7684\u5f00\u53d1\u8005\u4f53\u9a8c\u4f1a\u7ee7\u7eed\u8fed\u4ee3\u6539\u5584\u3002\u6211\u4eec\u6b63\u5728\u52aa\u529b\u5f00\u53d1\u5de5\u5177\u3001\u6a21\u677f\u548c\u5e93\uff0c\u4ee5\u5e2e\u52a9\u4f60\u5728\u65b0\u67b6\u6784\u4e0a\u5feb\u901f\u5165\u95e8\uff0c\u800c\u4e0d\u9700\u8981\u7ecf\u5386\u6574\u4e2a\u8bbe\u7f6e\u8fc7\u7a0b\u3002"]})]})}const l=function(e={}){const{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(a,e)})):a(e)}},76439:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>u});var t=r(24246),o=r(71670),a=r(61647);const l={id:"new-architecture-app-modules-ios",title:"\u5728 iOS \u4e0a\u542f\u7528 TurboModule"},i=void 0,s={id:"new-architecture-app-modules-ios",title:"\u5728 iOS \u4e0a\u542f\u7528 TurboModule",description:"Make sure your application meets all the prerequisites.",source:"@site/versioned_docs/version-0.73/new-architecture-app-modules-ios.md",sourceDirName:".",slug:"/new-architecture-app-modules-ios",permalink:"/docs/new-architecture-app-modules-ios",draft:!1,unlisted:!1,editUrl:"https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/new-architecture-app-modules-ios.md",tags:[],version:"0.73",frontMatter:{id:"new-architecture-app-modules-ios",title:"\u5728 iOS \u4e0a\u542f\u7528 TurboModule"}},d={},u=[{value:"1. Provide a TurboModuleManager Delegate",id:"1-provide-a-turbomodulemanager-delegate",level:2},{value:"TurboModuleManagerDelegate Example",id:"turbomodulemanagerdelegate-example",level:4},{value:"2. Install TurboModuleManager JavaScript Bindings",id:"2-install-turbomodulemanager-javascript-bindings",level:2},{value:"3. Enable TurboModule System",id:"3-enable-turbomodule-system",level:2},{value:"Example",id:"example",level:4}];function c(e){const n=Object.assign({p:"p",a:"a",h2:"h2",code:"code",pre:"pre",ul:"ul",li:"li",h4:"h4"},(0,o.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.ZP,{}),"\n",(0,t.jsxs)(n.p,{children:["Make sure your application meets all the ",(0,t.jsx)(n.a,{href:"new-architecture-app-intro",children:"prerequisites"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"1-provide-a-turbomodulemanager-delegate",children:"1. Provide a TurboModuleManager Delegate"}),"\n",(0,t.jsxs)(n.p,{children:["Add the following imports at the top of your bridge delegate (e.g. ",(0,t.jsx)(n.code,{children:"AppDelegate.mm"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-objc",children:"#import <ReactCommon/RCTTurboModuleManager.h>\n#import <React/CoreModulesPlugins.h>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You will also need to declare that your AppDelegate conforms to the ",(0,t.jsx)(n.code,{children:"RCTTurboModuleManagerDelegate"})," protocol, as well as create an instance variable for our Turbo Module manager:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-objc",children:"@interface AppDelegate () <RCTCxxBridgeDelegate, RCTTurboModuleManagerDelegate> {\n  // ...\n  RCTTurboModuleManager *_turboModuleManager;\n}\n@end\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To conform to the ",(0,t.jsx)(n.code,{children:"RCTTurboModuleManagerDelegate"})," protocol, you will implement these three methods:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getModuleClassFromName:"})," - This method should return the Class for a native module. You may use the ",(0,t.jsx)(n.code,{children:"RCTCoreModulesClassProvider()"})," method to handle the default, core modules."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getTurboModule:jsInvoker:"})," - This should return ",(0,t.jsx)(n.code,{children:"nullptr"}),". This method may be used later to support C++ TurboModules."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getModuleInstanceFromClass:moduleClass:"})," - This method allows you to perform any side-effects when your TurboModules are initialized. This is the TurboModule analogue to your bridge delegate\u2019s ",(0,t.jsx)(n.code,{children:"extraModulesForBridge"})," method. At this time, you\u2019ll need to initialize the default RCTNetworking and RCTImageLoader modules as indicated below."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"turbomodulemanagerdelegate-example",children:"TurboModuleManagerDelegate Example"}),"\n",(0,t.jsxs)(n.p,{children:["Take note of ",(0,t.jsx)(n.code,{children:"getModuleInstanceFromClass:"})," in the following example, as it includes some necessary instantiation of several core modules that you will need to include in your application. Eventually, this may not be required."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-objc",metastring:"title='AppDelegate.mm'",children:"// ...\n\n#import <React/RCTDataRequestHandler.h>\n#import <React/RCTHTTPRequestHandler.h>\n#import <React/RCTFileRequestHandler.h>\n#import <React/RCTNetworking.h>\n#import <React/RCTImageLoader.h>\n#import <React/RCTGIFImageDecoder.h>\n#import <React/RCTLocalAssetImageLoader.h>\n\n#import <React/CoreModulesPlugins.h>\n\n#import <ReactCommon/RCTTurboModuleManager.h>\n\n// ...\n\n#pragma mark RCTTurboModuleManagerDelegate\n\n- (Class)getModuleClassFromName:(const char *)name\n{\n  return RCTCoreModulesClassProvider(name);\n}\n\n- (std::shared_ptr<facebook::react::TurboModule>)\n    getTurboModule:(const std::string &)name\n         jsInvoker:(std::shared_ptr<facebook::react::CallInvoker>)jsInvoker {\n  return nullptr;\n}\n\n- (id<RCTTurboModule>)getModuleInstanceFromClass:(Class)moduleClass\n{\n  // Set up the default RCTImageLoader and RCTNetworking modules.\n  if (moduleClass == RCTImageLoader.class) {\n    return [[moduleClass alloc] initWithRedirectDelegate:nil\n        loadersProvider:^NSArray<id<RCTImageURLLoader>> *(RCTModuleRegistry * moduleRegistry) {\n          return @ [[RCTLocalAssetImageLoader new]];\n        }\n        decodersProvider:^NSArray<id<RCTImageDataDecoder>> *(RCTModuleRegistry * moduleRegistry) {\n          return @ [[RCTGIFImageDecoder new]];\n        }];\n  } else if (moduleClass == RCTNetworking.class) {\n     return [[moduleClass alloc]\n        initWithHandlersProvider:^NSArray<id<RCTURLRequestHandler>> *(\n            RCTModuleRegistry *moduleRegistry) {\n          return @[\n            [RCTHTTPRequestHandler new],\n            [RCTDataRequestHandler new],\n            [RCTFileRequestHandler new],\n          ];\n        }];\n  }\n  // No custom initializer here.\n  return [moduleClass new];\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"2-install-turbomodulemanager-javascript-bindings",children:"2. Install TurboModuleManager JavaScript Bindings"}),"\n",(0,t.jsxs)(n.p,{children:["Next, you will create a ",(0,t.jsx)(n.code,{children:"RCTTurboModuleManager"})," in your bridge delegate\u2019s ",(0,t.jsx)(n.code,{children:"jsExecutorFactoryForBridge:"})," method, and install the JavaScript bindings:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-objc",children:'#pragma mark - RCTCxxBridgeDelegate\n\n- (std::unique_ptr<facebook::react::JSExecutorFactory>)jsExecutorFactoryForBridge:(RCTBridge *)bridge\n{\n  // Add these lines to create a TurboModuleManager\n  if (RCTTurboModuleEnabled()) {\n    _turboModuleManager =\n        [[RCTTurboModuleManager alloc] initWithBridge:bridge\n                                             delegate:self\n                                            jsInvoker:bridge.jsCallInvoker];\n\n    // Necessary to allow NativeModules to lookup TurboModules\n    [bridge setRCTTurboModuleRegistry:_turboModuleManager];\n\n    if (!RCTTurboModuleEagerInitEnabled()) {\n      /**\n       * Instantiating DevMenu has the side-effect of registering\n       * shortcuts for CMD + d, CMD + i,  and CMD + n via RCTDevMenu.\n       * Therefore, when TurboModules are enabled, we must manually create this\n       * NativeModule.\n       */\n       [_turboModuleManager moduleForName:"DevMenu"];\n    }\n  }\n\n  // Add this line...\n  __weak __typeof(self) weakSelf = self;\n\n  // If you want to use the `JSCExecutorFactory`, remember to add the `#import <React/JSCExecutorFactory.h>`\n  // import statement on top.\n  return std::make_unique<facebook::react::HermesExecutorFactory>(\n    facebook::react::RCTJSIExecutorRuntimeInstaller([weakSelf, bridge](facebook::jsi::Runtime &runtime) {\n      if (!bridge) {\n        return;\n      }\n\n      // And add these lines to install the bindings...\n      __typeof(self) strongSelf = weakSelf;\n      if (strongSelf) {\n        facebook::react::RuntimeExecutor syncRuntimeExecutor =\n            [&](std::function<void(facebook::jsi::Runtime & runtime_)> &&callback) { callback(runtime); };\n        [strongSelf->_turboModuleManager installJSBindingWithRuntimeExecutor:syncRuntimeExecutor];\n      }\n    }));\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"3-enable-turbomodule-system",children:"3. Enable TurboModule System"}),"\n",(0,t.jsxs)(n.p,{children:["Finally, enable TurboModules in your app by executing the following statement before React Native is initialized in your app delegate (e.g. within ",(0,t.jsx)(n.code,{children:"didFinishLaunchingWithOptions:"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-objc",children:"RCTEnableTurboModule(YES);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-objc",children:"@implementation AppDelegate\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions\n{\n  RCTEnableTurboModule(YES);\n\n  RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:self\n                                            launchOptions:launchOptions];\n\n  // ...\n\n  return YES;\n}\n"})})]})}const m=function(e={}){const{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(c,e)})):c(e)}},71426:(e,n,r)=>{var t=r(27378),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function d(e,n,r){var t,a={},d=null,u=null;for(t in void 0!==r&&(d=""+r),void 0!==n.key&&(d=""+n.key),void 0!==n.ref&&(u=n.ref),n)l.call(n,t)&&!s.hasOwnProperty(t)&&(a[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===a[t]&&(a[t]=n[t]);return{$$typeof:o,type:e,key:d,ref:u,props:a,_owner:i.current}}n.Fragment=a,n.jsx=d,n.jsxs=d},24246:(e,n,r)=>{e.exports=r(71426)},71670:(e,n,r)=>{r.d(n,{Zo:()=>i,ah:()=>a});var t=r(27378);const o=t.createContext({});function a(e){const n=t.useContext(o);return t.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const l={};function i({components:e,children:n,disableParentContext:r}){let i;return i=r?"function"==typeof e?e({}):e||l:a(e),t.createElement(o.Provider,{value:i},n)}}}]);