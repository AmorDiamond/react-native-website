<!doctype html>
<html class="docs-version-0.67" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="search" type="application/opensearchdescription+xml" title="React Native 中文网" href="/opensearch.xml">
<script src="//snack.expo.dev/embed.js" defer="defer"></script>
<script src="//cdn.wwads.cn/js/makemoney.js" defer="defer"></script><title data-react-helmet="true">Troubleshooting · React Native 中文网</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="twitter:image" content="https://reactnative.cn/img/logo-og.png"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="0.67"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-0.67"><meta data-react-helmet="true" property="og:url" content="https://reactnative.cn"><meta data-react-helmet="true" property="og:image" content="img/logo-og.png"><meta data-react-helmet="true" property="og:title" content="Troubleshooting · React Native 中文网"><meta data-react-helmet="true" name="description" content="This page contains resolutions to common problem you might face when migrating to the New Architecture."><meta data-react-helmet="true" property="og:description" content="This page contains resolutions to common problem you might face when migrating to the New Architecture."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://reactnative.cn/docs/new-architecture-troubleshooting"><link data-react-helmet="true" rel="alternate" href="https://reactnative.cn/docs/new-architecture-troubleshooting" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://reactnative.cn/docs/new-architecture-troubleshooting" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.cbfb91cb.css">
<link rel="preload" href="/assets/js/runtime~main.4124c169.js" as="script">
<link rel="preload" href="/assets/js/main.5540c489.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_3wvD">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/header_logo.svg" alt="React Native 中文网" class="themedImage_Ir0T themedImage--light_2_E0"><img src="/img/header_logo.svg" alt="React Native 中文网" class="themedImage_Ir0T themedImage--dark_2JiM"></div><b class="navbar__title">React Native 中文网</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/docs/getting-started">0.67</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/new-architecture-troubleshooting">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/new-architecture-troubleshooting">0.67</a></li><li><a class="dropdown__link" href="/docs/0.66/getting-started">0.66</a></li><li><a class="dropdown__link" href="/docs/0.65/getting-started">0.65</a></li><li><a class="dropdown__link" href="/docs/0.64/getting-started">0.64</a></li><li><a class="dropdown__link" href="/docs/0.63/getting-started">0.63</a></li><li><a class="dropdown__link" href="/versions">所有版本</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/getting-started">文档</a><a class="navbar__item navbar__link" href="/docs/components-and-apis">组件</a><a class="navbar__item navbar__link" href="/docs/accessibilityinfo">API</a><a class="navbar__item navbar__link" href="/docs/architecture-overview">架构</a><a href="//time.geekbang.org/column/intro/100110101?code=FAqHFVRUur%2FgAP-yJQWitk9ieF80imRky3PVsIs%2FX6A%3D" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link hot-link"><span>实战课<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_pqex"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="//github.com/reactnativecn/react-native-website/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>讨论<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_pqex"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="//pushy.reactnative.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link hot-link"><span>热更新<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_pqex"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a class="navbar__item navbar__link" href="/about">关于</a><a href="//github.com/facebook/react-native" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><div class="toggle_2wFP toggle_2vag toggleDisabled_1jUP"><div class="toggleTrack_OYnE" role="button" tabindex="-1"><div class="toggleTrackCheck_3aVv"><span class="toggleIcon_1mQT">🌜</span></div><div class="toggleTrackX_oB48"><span class="toggleIcon_1mQT">🌞</span></div><div class="toggleTrackThumb_3qal"></div></div><input type="checkbox" class="toggleScreenReader_bg_d" aria-label="Switch between dark and light mode"></div><div class="searchBox_WYtD"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_3jyA"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_2PbN" type="button"></button><main class="docMainContainer_28SP docMainContainerEnhanced_YA74"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2rXS"><div class="docItemContainer_1EXp"><article><a href="https://time.geekbang.org/column/intro/100110101?code=FAqHFVRUur%2FgAP-yJQWitk9ieF80imRky3PVsIs%2FX6A%3D" target="_blank" style="display:block;padding:12px;background-color:#eee;color:#666;margin-bottom:15px"><span style="font-weight:bold;color:#05a5d1">新架构实战课</span> <!-- -->实操 + 基建 + 原理全维度包揽，抢先掌握 React Native 新架构精髓<!-- --> <span style="border:solid 1px #666;padding:4px 6px;margin-left:8px;vertical-align:middle">立即查看 &gt;</span></a><div class="markdown"><header><h1>Troubleshooting</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This documentation is still <strong>experimental</strong> and details are subject to changes as we iterate. Feel free to share your feedback on the <a href="https://github.com/reactwg/react-native-new-architecture/discussions/8" target="_blank" rel="noopener noreferrer">discussion inside the working group</a> for this page.</p><p>Moreover, it contains several <strong>manual steps</strong>. Please note that this won&#x27;t be representative of the final developer experience once the New Architecture is stable. We&#x27;re working on tools, templates and libraries to help you get started fast on the New Architecture, without having to go through the whole setup.</p></div></div><p>This page contains resolutions to common problem you might face when migrating to the New Architecture.</p><h2 class="anchor anchorWithStickyNavbar_23Bc" id="xcode-build-issues">Xcode Build Issues<a class="hash-link" href="#xcode-build-issues" title="Direct link to heading">​</a></h2><p>Should the XCode Build fail with:</p><p><strong>Command PhaseScriptExecution failed with a nonzero exit code</strong></p><p>This error indicates that the codegen script that is injected into the Xcode build pipeline has exited early. You may get this for either your own library, or one of the core RN libraries (FBReactNativeSpec, rncore).</p><p>Open <code>~/Library/Developer/Xcode/DerivedData</code>. and look for a folder named after your Xcode workspace (“RNTesterPods-AAAA” where “AAAA” is a string of characters). Within that folder, go to Build → Intermediates.noindex → Pods.build → Debug-iphonesimulator (or the equivalent for your iOS device, if applicable). Inside, look for the folder named after the codegen library has the script error. The logs for the script phase can be found within the DerivedSources folder, in a file named <code>codegen-LibraryName.log</code>. This log output should provide clarity on the source of the error.</p><h2 class="anchor anchorWithStickyNavbar_23Bc" id="cocoapods-and-node-reset">CocoaPods and Node Reset<a class="hash-link" href="#cocoapods-and-node-reset" title="Direct link to heading">​</a></h2><p>The CocoaPods integration will see frequent updates as we rollout the New Architecture, and it is possible to end up with your workspace in a broken state after one of these changes. You may clean up any changes related to the codegen by performing some of these steps:</p><ol><li>Run <code>pod deintegrate</code> in your ios directory (or wherever your Podfile is located) and re-run <code>pod install</code> (or <code>arch -x86_64 pod install</code>, in case of a Mac M1).</li><li>Delete <code>Podfile.lock</code> and re-run <code>pod install</code> (or <code>arch -x86_64 pod install</code>, in case of a Mac M1).</li><li>Delete <code>node_modules</code> and re-run <code>yarn install</code>.</li><li>Delete your codegen artifacts and re-run <code>pod install</code> (or <code>arch -x86_64 pod install</code>, in case of a Mac M1), then clean and build your Xcode project.</li></ol><h2 class="anchor anchorWithStickyNavbar_23Bc" id="folly-version">Folly Version<a class="hash-link" href="#folly-version" title="Direct link to heading">​</a></h2><p>As it happens, the Folly version used in your podspec must match whatever version is used in React Native at this time. If you see the following error after running <code>pod install</code>:</p><div class="codeBlockContainer_1ukp theme-code-block"><div class="codeBlockContent_3Y8q jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_2Xgr thin-scrollbar" style="color:#FFFFFF;background:#282C34"><code class="codeBlockLines_3Zfi"><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token punctuation" style="color:#657b83">[</span><span class="token operator" style="color:#fc929e">!</span><span class="token punctuation" style="color:#657b83">]</span><span class="token plain"> CocoaPods could not find compatible versions </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> pod </span><span class="token string" style="color:#8dc891">&quot;RCT-Folly&quot;</span><span class="token operator" style="color:#fc929e">:</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1mju clean-btn">Copy</button></div></div><p>...you may have a version-mismatch. Take a look at your <code>node_modules/react-native/React/FBReactNativeSpec/FBReactNativeSpec.podspec</code> file and make note of the <code>folly_version</code> used there. Go back to your own podspec and set your <code>folly_version</code> to match.</p><h2 class="anchor anchorWithStickyNavbar_23Bc" id="android-build-is-failing-with-outofmemoryexception">Android build is failing with <code>OutOfMemoryException</code><a class="hash-link" href="#android-build-is-failing-with-outofmemoryexception" title="Direct link to heading">​</a></h2><p>If your Android Gradle builds are failing with: <code>OutOfMemoryException: Out of memory: Java heap space.</code> or similar errors related to low memory, you might need to increase the memory allocated to the JVM.</p><p>You can do that by editing the <code>gradle.properties</code> file in your <code>android/gradle.properties</code> folder:</p><div class="codeBlockContainer_1ukp language-diff theme-code-block"><div class="codeBlockContent_3Y8q diff"><pre tabindex="0" class="prism-code language-diff codeBlock_2Xgr thin-scrollbar" style="color:#FFFFFF;background:#282C34"><code class="codeBlockLines_3Zfi"><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"># Specifies the JVM arguments used for the daemon process.</span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"># The setting is particularly useful for tweaking memory settings.</span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"># Default value: -Xmx1024m -XX:MaxPermSize=256m</span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:#cb4b16">-</span><span class="token deleted-sign deleted line" style="color:#cb4b16"># org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</span><br></span><span class="token-line" style="color:#FFFFFF;background:#282C34"><span class="token deleted-sign deleted line" style="color:#cb4b16"></span><span class="token inserted-sign inserted prefix inserted" style="color:#859900">+</span><span class="token inserted-sign inserted line" style="color:#859900">org.gradle.jvmargs=-Xmx4g -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1mju clean-btn">Copy</button></div></div><p>Make sure to uncomment the line and set the preferred memory size with the <code>-Xmx</code> parameter. 2Gb should be the minimum required and 4Gb is recommended.</p><h2 class="anchor anchorWithStickyNavbar_23Bc" id="android-ndk-and-mac-with-m1-apple-silicon-cpus">Android NDK and Mac with M1 Apple Silicon CPUs<a class="hash-link" href="#android-ndk-and-mac-with-m1-apple-silicon-cpus" title="Direct link to heading">​</a></h2><p>We&#x27;re aware of a series of incompatibilities between the Android NDK and Macs on M1 CPUs (<a href="https://github.com/android/ndk/issues/1299" target="_blank" rel="noopener noreferrer">here</a> and <a href="https://github.com/android/ndk/issues/1410" target="_blank" rel="noopener noreferrer">here</a>).
As you need to enable the NDK when building from source, you might face problems during your build.</p><p>The workaround at this stage is <a href="https://github.com/android/ndk/issues/1299" target="_blank" rel="noopener noreferrer">suggested here</a>.
As newer version of the Android SDK/NDK are released, we will update the documentation with the necessary steps.</p></div><footer class="docMetadata row docusaurus-mt-lg"><div class="col"><a href="https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/new-architecture-troubleshooting.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_1CBY" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_1szQ"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_rbnR thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#xcode-build-issues" class="table-of-contents__link toc-highlight">Xcode Build Issues</a></li><li><a href="#cocoapods-and-node-reset" class="table-of-contents__link toc-highlight">CocoaPods and Node Reset</a></li><li><a href="#folly-version" class="table-of-contents__link toc-highlight">Folly Version</a></li><li><a href="#android-build-is-failing-with-outofmemoryexception" class="table-of-contents__link toc-highlight">Android build is failing with <code>OutOfMemoryException</code></a></li><li><a href="#android-ndk-and-mac-with-m1-apple-silicon-cpus" class="table-of-contents__link toc-highlight">Android NDK and Mac with M1 Apple Silicon CPUs</a></li></ul><div class="wwads-cn wwads-vertical" data-id="58" style="max-width:200px;margin-top:20px"></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">React Native 中文网 © 2022 武汉青罗网络科技有限公司
      <a style="margin-left:10px" href="http://beian.miit.gov.cn/">鄂ICP备20002031号-3</a>
      <img style="width:25px" src="//img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png" alt="鄂公网安备 42011202001821号">
      <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42011202001821">鄂公网安备 42011202001821号</a>
      </div></div></div></footer></div>
<script src="/assets/js/runtime~main.4124c169.js"></script>
<script src="/assets/js/main.5540c489.js"></script>
</body>
</html>