"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[15860],{35318:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(27378);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=c(a),m=r,f=u["".concat(s,".").concat(m)]||u[m]||p[m]||o;return a?n.createElement(f,i(i({ref:t},d),{},{components:a})):n.createElement(f,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},11674:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(63445);const r=!!n.Z.canUseDOM&&navigator.platform.startsWith("Mac"),o=!!n.Z.canUseDOM&&navigator.platform.startsWith("Win"),i={defaultGuide:"native",defaultOs:r?"macos":o?"windows":"linux",defaultPackageManager:"npm",defaultPlatform:r?"ios":"android",defaultSyntax:"functional",getDevNotesTabs:(e=["android","ios","web","windows"])=>[e.includes("android")?{label:"Android",value:"android"}:void 0,e.includes("ios")?{label:"iOS",value:"ios"}:void 0,e.includes("web")?{label:"Web",value:"web"}:void 0,e.includes("windows")?{label:"Windows",value:"windows"}:void 0].filter(Boolean),guides:[{label:"\u5b8c\u6574\u539f\u751f\u73af\u5883",value:"native"},{label:"\u7b80\u6613\u6c99\u76d2\u73af\u5883",value:"quickstart"}],oses:[{label:"macOS",value:"macos"},{label:"Windows",value:"windows"},{label:"Linux",value:"linux"}],packageManagers:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],platforms:[{label:"Android",value:"android"},{label:"iOS",value:"ios"}],syntax:[{label:"\u51fd\u6570\u5f0f\u7ec4\u4ef6",value:"functional"},{label:"Class \u7ec4\u4ef6",value:"classical"}]}},86386:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(27378),r=a(38944);const o="tabItem_wHwb";var i=Object.defineProperty,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=(e,t,a)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;function p({children:e,hidden:t,className:a}){return n.createElement("div",((e,t)=>{for(var a in t||(t={}))s.call(t,a)&&d(e,a,t[a]);if(l)for(var a of l(t))c.call(t,a)&&d(e,a,t[a]);return e})({role:"tabpanel",className:(0,r.Z)(o,a)},{hidden:t}),e)}},27789:(e,t,a)=>{a.d(t,{Z:()=>w});var n=a(27378),r=a(38944),o=a(14185),i=a(27886),l=a(77184),s=a(12112);const c="tabList_J5MA",d="tabItem_l0OV";var p=Object.defineProperty,u=Object.defineProperties,m=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,v=(e,t,a)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))b.call(t,a)&&v(e,a,t[a]);if(f)for(var a of f(t))h.call(t,a)&&v(e,a,t[a]);return e};function y(e){var t,a;const{lazy:o,block:p,defaultValue:f,values:b,groupId:h,className:v}=e,y=n.Children.map(e.children,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),w=null!=b?b:y.map((({props:{value:e,label:t,attributes:a}})=>({value:e,label:t,attributes:a}))),k=(0,i.l)(w,((e,t)=>e.value===t.value));if(k.length>0)throw new Error(`Docusaurus error: Duplicate values "${k.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const N=null===f?f:null!=(a=null!=f?f:null==(t=y.find((e=>e.props.default)))?void 0:t.props.value)?a:y[0].props.value;if(null!==N&&!w.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${w.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:O,setTabGroupChoices:x}=(0,l.U)(),[C,j]=(0,n.useState)(N),P=[],{blockElementScrollPositionUntilNextRender:A}=(0,s.o5)();if(null!=h){const e=O[h];null!=e&&e!==C&&w.some((t=>t.value===e))&&j(e)}const E=e=>{const t=e.currentTarget,a=P.indexOf(t),n=w[a].value;n!==C&&(A(t),j(n),null!=h&&x(h,String(n)))},S=e=>{var t,a;let n=null;switch(e.key){case"Enter":E(e);break;case"ArrowRight":{const a=P.indexOf(e.currentTarget)+1;n=null!=(t=P[a])?t:P[0];break}case"ArrowLeft":{const t=P.indexOf(e.currentTarget)-1;n=null!=(a=P[t])?a:P[P.length-1];break}}null==n||n.focus()};return n.createElement("div",{className:(0,r.Z)("tabs-container",c)},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":p},v)},w.map((({value:e,label:t,attributes:a})=>{return n.createElement("li",(o=g({role:"tab",tabIndex:C===e?0:-1,"aria-selected":C===e,key:e,ref:e=>P.push(e),onKeyDown:S,onClick:E},a),i={className:(0,r.Z)("tabs__item",d,null==a?void 0:a.className,{"tabs__item--active":C===e})},u(o,m(i))),null!=t?t:e);var o,i}))),o?(0,n.cloneElement)(y.filter((e=>e.props.value===C))[0],{className:"margin-top--md"}):n.createElement("div",{className:"margin-top--md"},y.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==C})))))}function w(e){const t=(0,o.Z)();return n.createElement(y,g({key:String(t)},e))}},97083:(e,t,a)=>{a.d(t,{ZP:()=>m});var n=a(35318),r=Object.defineProperty,o=Object.defineProperties,i=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=(e,t,a)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,p=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&d(e,a,t[a]);if(l)for(var a of l(t))c.call(t,a)&&d(e,a,t[a]);return e};const u={toc:[]};function m(e){var t,a=e,{components:r}=a,d=((e,t)=>{var a={};for(var n in e)s.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&l)for(var n of l(e))t.indexOf(n)<0&&c.call(e,n)&&(a[n]=e[n]);return a})(a,["components"]);return(0,n.kt)("wrapper",(t=p(p({},u),d),o(t,i({components:r,mdxType:"MDXLayout"}))),(0,n.kt)("admonition",p({},{type:"caution"}),(0,n.kt)("p",{parentName:"admonition"},"This documentation is still ",(0,n.kt)("strong",{parentName:"p"},"experimental")," and details are subject to changes as we iterate. Feel free to share your feedback on the ",(0,n.kt)("a",p({parentName:"p"},{href:"https://github.com/reactwg/react-native-new-architecture/discussions/8"}),"discussion inside the working group")," for this page."),(0,n.kt)("p",{parentName:"admonition"},"Moreover, it contains several ",(0,n.kt)("strong",{parentName:"p"},"manual steps"),". Please note that this won't be representative of the final developer experience once the New Architecture is stable. We're working on tools, templates and libraries to help you get started fast on the New Architecture, without having to go through the whole setup.")))}m.isMDXComponent=!0},37425:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>y,contentTitle:()=>v,default:()=>N,frontMatter:()=>h,metadata:()=>g,toc:()=>w});var n=a(35318),r=a(97083),o=a(27789),i=a(86386),l=a(11674),s=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,b=(e,t)=>{for(var a in t||(t={}))u.call(t,a)&&f(e,a,t[a]);if(p)for(var a of p(t))m.call(t,a)&&f(e,a,t[a]);return e};const h={id:"new-architecture-library-android",title:"\u5728 Android \u5e93\u4e2d\u542f\u7528"},v=void 0,g={unversionedId:"new-architecture-library-android",id:"version-0.69/new-architecture-library-android",title:"\u5728 Android \u5e93\u4e2d\u542f\u7528",description:"Once you have defined the JavaScript specs for your native modules as part of the prerequisites and followed the Android/Gradle setup, you are now ready to migrate your library to the new architecture. Here are the steps you can follow to accomplish this.",source:"@site/versioned_docs/version-0.69/new-architecture-library-android.md",sourceDirName:".",slug:"/new-architecture-library-android",permalink:"/docs/0.69/new-architecture-library-android",draft:!1,editUrl:"https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/../cndocs/new-architecture-library-android.md",tags:[],version:"0.69",frontMatter:{id:"new-architecture-library-android",title:"\u5728 Android \u5e93\u4e2d\u542f\u7528"},sidebar:"docs",previous:{title:"\u5728\u5e93\u4e2d\u542f\u7528\u7684\u9884\u5907\u5de5\u4f5c",permalink:"/docs/0.69/new-architecture-library-intro"},next:{title:"\u5728 iOS \u5e93\u4e2d\u542f\u7528",permalink:"/docs/0.69/new-architecture-library-ios"}},y={},w=[{value:"1. Configure Codegen in your Gradle File",id:"1-configure-codegen-in-your-gradle-file",level:3},{value:"2. Extend or implement the code-generated native interfaces",id:"2-extend-or-implement-the-code-generated-native-interfaces",level:2},{value:"Extends the abstract class provided by the codegen",id:"extends-the-abstract-class-provided-by-the-codegen",level:3}],k={toc:w};function N(e){var t,a=e,{components:s}=a,f=((e,t)=>{var a={};for(var n in e)u.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&p)for(var n of p(e))t.indexOf(n)<0&&m.call(e,n)&&(a[n]=e[n]);return a})(a,["components"]);return(0,n.kt)("wrapper",(t=b(b({},k),f),c(t,d({components:s,mdxType:"MDXLayout"}))),(0,n.kt)(r.ZP,{mdxType:"NewArchitectureWarning"}),(0,n.kt)("p",null,"Once you have defined the JavaScript specs for your native modules as part of the ",(0,n.kt)("a",b({parentName:"p"},{href:"new-architecture-library-intro"}),"prerequisites")," and followed the Android/Gradle setup, you are now ready to migrate your library to the new architecture. Here are the steps you can follow to accomplish this."),(0,n.kt)("h3",b({},{id:"1-configure-codegen-in-your-gradle-file"}),"1. Configure Codegen in your Gradle File"),(0,n.kt)("p",null,"You can now configure Codegen by specifying the following in the module-level ",(0,n.kt)("inlineCode",{parentName:"p"},"build.gradle")," file:"),(0,n.kt)("pre",null,(0,n.kt)("code",b({parentName:"pre"},{className:"language-groovy"}),'react {\n    libraryName = "samplelibrary"\n    codegenJavaPackageName = "com.example.samplelibrary"\n    root = rootProject.file("..")\n    jsRootDir = rootProject.file("../js/")\n    reactNativeDir = rootProject.file("../node_modules/react-native/")\n    codegenDir = rootProject.file("../node_modules/react-native-codegen/")\n}\n')),(0,n.kt)("admonition",b({},{type:"info"}),(0,n.kt)("p",{parentName:"admonition"},"Please note that this setup requires you to have the React Gradle Plugin configured in the prerequisite step).")),(0,n.kt)("p",null,"All the arguments are ",(0,n.kt)("strong",{parentName:"p"},"optional")," and provide ",(0,n.kt)("strong",{parentName:"p"},"default values"),", you might want to customize them to follow your setup."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"libraryName"),": A string that identifies your library. By default, the codegen will use a library name that is derived from the name of the module with a ",(0,n.kt)("inlineCode",{parentName:"li"},"Spec")," suffix. E.g. for ",(0,n.kt)("inlineCode",{parentName:"li"},":example:project")," it will be ",(0,n.kt)("inlineCode",{parentName:"li"},"ExampleProjectSpec"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"codegenJavaPackageName"),": A string that represents the Java package your code should use. By default this will be ",(0,n.kt)("inlineCode",{parentName:"li"},"com.facebook.fbreact.specs")," but you might want to customize it."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"root"),": Reference to the root of your project. By default is ",(0,n.kt)("inlineCode",{parentName:"li"},"..")," as Gradle is running inside the ",(0,n.kt)("inlineCode",{parentName:"li"},"./android")," folder."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"reactNativeDir"),": Reference to the ",(0,n.kt)("inlineCode",{parentName:"li"},"react-native")," package root. Usually located inside ",(0,n.kt)("inlineCode",{parentName:"li"},"../node_modules/react-native"),". For third-party NPM libraries that are installed in ",(0,n.kt)("inlineCode",{parentName:"li"},"node_modules"),", this will be ",(0,n.kt)("inlineCode",{parentName:"li"},"../react-native"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"jsRootDir"),": Reference to the directory that contains the JavaScript specs for this library. By default is ",(0,n.kt)("inlineCode",{parentName:"li"},"../js/"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"codegenDir"),": Reference to the ",(0,n.kt)("inlineCode",{parentName:"li"},"react-native-codegen")," root. Usually located inside ",(0,n.kt)("inlineCode",{parentName:"li"},"../node_modules/react-native-codegen"),".")),(0,n.kt)("p",null,"The generator will write its output inside the ",(0,n.kt)("strong",{parentName:"p"},"build folder"),", specifically inside the ",(0,n.kt)("inlineCode",{parentName:"p"},"./build/generated/source/codegen")," folder."),(0,n.kt)("h2",b({},{id:"2-extend-or-implement-the-code-generated-native-interfaces"}),"2. Extend or implement the code-generated native interfaces"),(0,n.kt)("p",null,"The JavaScript spec for your native module or component will be used to generate native interface code for each supported platform (i.e. Android and iOS). These native interface files will be generated ",(0,n.kt)("strong",{parentName:"p"},"when a React Native application that depends on your library is built"),"."),(0,n.kt)("p",null,"While this generated native interface code ",(0,n.kt)("strong",{parentName:"p"},"will not ship as part of your library"),", you do need to make sure your Java/Kotlin code conforms to the protocols provided by these native interface files."),(0,n.kt)("p",null,"You can invoke the ",(0,n.kt)("inlineCode",{parentName:"p"},"generateCodegenArtifactsFromSchema")," Gradle task to generate your library\u2019s native interface code in order to use them ",(0,n.kt)("strong",{parentName:"p"},"as a reference:")),(0,n.kt)("pre",null,(0,n.kt)("code",b({parentName:"pre"},{className:"language-bash"}),"./gradlew generateCodegenArtifactsFromSchema\n")),(0,n.kt)("p",null,"The files that are output can be found inside ",(0,n.kt)("inlineCode",{parentName:"p"},"build/generated/source/codegen")," and ",(0,n.kt)("strong",{parentName:"p"},"should not be committed"),", but you\u2019ll need to refer to them to determine what changes you need to make to your native modules in order for them to provide an implementation for each generated interface."),(0,n.kt)("p",null,"The output of the codegen for a module called ",(0,n.kt)("inlineCode",{parentName:"p"},"NativeAwesomeManager")," will look like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",b({parentName:"pre"},{}),"app/build/generated/source/codegen\n\u251c\u2500\u2500 java\n\u2502   \u2514\u2500\u2500 com\n\u2502       \u2514\u2500\u2500 example\n\u2502           \u2514\u2500\u2500 samplelibrary\n\u2502               \u2514\u2500\u2500 NativeAwesomeManagerSpec.java\n\u251c\u2500\u2500 jni\n\u2502   \u251c\u2500\u2500 Android.mk\n\u2502   \u251c\u2500\u2500 react\n\u2502   \u2502   \u2514\u2500\u2500 renderer\n\u2502   \u2502       \u2514\u2500\u2500 components\n\u2502   \u2502           \u2514\u2500\u2500 samplelibrary\n\u2502   \u2502               \u251c\u2500\u2500 ComponentDescriptors.h\n\u2502   \u2502               \u251c\u2500\u2500 EventEmitters.cpp\n\u2502   \u2502               \u251c\u2500\u2500 EventEmitters.h\n\u2502   \u2502               \u251c\u2500\u2500 Props.cpp\n\u2502   \u2502               \u251c\u2500\u2500 Props.h\n\u2502   \u2502               \u251c\u2500\u2500 ShadowNodes.cpp\n\u2502   \u2502               \u2514\u2500\u2500 ShadowNodes.h\n\u2502   \u251c\u2500\u2500 samplelibrary-generated.cpp\n\u2502   \u2514\u2500\u2500 samplelibrary.h\n\u2514\u2500\u2500 schema.json\n")),(0,n.kt)("h3",b({},{id:"extends-the-abstract-class-provided-by-the-codegen"}),"Extends the abstract class provided by the codegen"),(0,n.kt)("p",null,"Update your native module or component to ensure it ",(0,n.kt)("strong",{parentName:"p"},"extends the abstract class")," that has been code-generated from your JavaScript specs (i.e. the ",(0,n.kt)("inlineCode",{parentName:"p"},"NativeAwesomeManagerSpec.java")," file from the previous example)."),(0,n.kt)("p",null,"Following the example set forth in the previous section, your library might import ",(0,n.kt)("inlineCode",{parentName:"p"},"NativeAwesomeManagerSpec"),", implement the relevant native interface and the necessary methods for it:"),(0,n.kt)(o.Z,{groupId:"android-language",defaultValue:l.Z.defaultAndroidLanguage,values:l.Z.androidLanguages,mdxType:"Tabs"},(0,n.kt)(i.Z,{value:"java",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",b({parentName:"pre"},{className:"language-java"}),'import androidx.annotation.NonNull;\n\nimport com.example.samplelibrary.NativeAwesomeManagerSpec;\nimport com.facebook.react.bridge.Promise;\nimport com.facebook.react.bridge.ReactApplicationContext;\n\npublic class NativeAwesomeManager extends NativeAwesomeManagerSpec {\n\n    public static final String NAME = "NativeAwesomeManager";\n\n    public NativeAwesomeManager(ReactApplicationContext reactContext) {\n        super(reactContext);\n    }\n\n    @Override\n    public void getString(String id, Promise promise) {\n        // Implement this method\n    }\n\n    @NonNull\n    @Override\n    public String getName() {\n        return NAME;\n    }\n}\n'))),(0,n.kt)(i.Z,{value:"kotlin",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",b({parentName:"pre"},{className:"language-kotlin"}),'import com.example.samplelibrary.NativeAwesomeManagerSpec\nimport com.facebook.react.bridge.Promise\nimport com.facebook.react.bridge.ReactApplicationContext\n\nclass NativeAwesomeManager(reactContext: ReactApplicationContext) :\n    NativeAwesomeManagerSpec(reactContext) {\n    override fun getString(id: String, promise: Promise) {\n        // Implement this method\n    }\n\n    override fun getName() = NAME\n\n    companion object {\n        val NAME = "NativeAwesomeManager"\n    }\n}\n')))),(0,n.kt)("p",null,"Please note that the ",(0,n.kt)("strong",{parentName:"p"},"generated abstract class")," that you\u2019re now extending (",(0,n.kt)("inlineCode",{parentName:"p"},"MyAwesomeSpec")," in this example), is itself extending ",(0,n.kt)("inlineCode",{parentName:"p"},"ReactContextBaseJavaModule"),". Therefore you should not use access to any of the method/fields you were previously using (e.g. the ",(0,n.kt)("inlineCode",{parentName:"p"},"ReactApplicationContext")," and so on). Moreover the generated class will now also implement the ",(0,n.kt)("inlineCode",{parentName:"p"},"TurboModule")," interface for you."))}N.isMDXComponent=!0}}]);