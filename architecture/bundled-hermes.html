<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-architecture docs-doc-id-bundled-hermes">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">内置 Hermes 引擎 · React Native 中文网</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:image" content="https://reactnative.cn/img/logo-og.png"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:url" content="https://reactnative.cn"><meta data-rh="true" property="og:image" content="img/logo-og.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-architecture-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-architecture-current"><meta data-rh="true" property="og:title" content="内置 Hermes 引擎 · React Native 中文网"><meta data-rh="true" name="description" content="This page gives an overview of how Hermes and React Native are built."><meta data-rh="true" property="og:description" content="This page gives an overview of how Hermes and React Native are built."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://reactnative.cn/architecture/bundled-hermes"><link data-rh="true" rel="alternate" href="https://reactnative.cn/architecture/bundled-hermes" hreflang="en"><link data-rh="true" rel="alternate" href="https://reactnative.cn/architecture/bundled-hermes" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GJGDC5L5HP-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-63485149-4","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-63485149-4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-63485149-4",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="React Native 中文网" href="/opensearch.xml">


<script src="//snack.expo.dev/embed.js" defer="defer"></script>
<script src="//cdn.wwads.cn/js/makemoney.js" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.b977ccb3.css">
<link rel="preload" href="/assets/js/runtime~main.eab225d6.js" as="script">
<link rel="preload" href="/assets/js/main.dee7dd97.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_oPtH">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/header_logo.svg" alt="React Native 中文网" class="themedImage_BQGR themedImage--light_HAxW"><img src="/img/header_logo.svg" alt="React Native 中文网" class="themedImage_BQGR themedImage--dark_bGx0"></div><b class="navbar__title text--truncate">React Native 中文网</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/getting-started">文档</a><a class="navbar__item navbar__link" href="/docs/components-and-apis">组件</a><a class="navbar__item navbar__link" href="/docs/accessibilityinfo">API</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/architecture/overview">架构</a><a href="//time.geekbang.org/column/intro/100110101?code=FAqHFVRUur%2FgAP-yJQWitk9ieF80imRky3PVsIs%2FX6A%3D" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link hot-link">实战课<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="//github.com/reactnativecn/react-native-website/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">讨论<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="//pushy.reactnative.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link hot-link">热更新<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/about">关于</a><a href="//github.com/facebook/react-native" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_WqAV"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_MB5r docsWrapper_ct1J"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iEvu" type="button"></button><div class="docPage_KLoz"><aside class="theme-doc-sidebar-container docSidebarContainer_y0RQ"><div class="sidebar_CUen"><nav class="menu thin-scrollbar menu_jmj1"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/architecture/overview">架构</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/overview">架构概览</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0">渲染</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/fabric-renderer">Fabric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/render-pipeline">渲染，提交与挂载（渲染流水线）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/xplat-implementation">跨平台的实现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/view-flattening">视图拍平</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/threading-model">线程模型</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0">构建工具</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/architecture/bundled-hermes">内置 Hermes 引擎</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/glossary">术语表</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_sTIZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Qr34"><div class="docItemContainer_tjFy"><article><a href="https://time.geekbang.org/column/intro/100110101?code=FAqHFVRUur%2FgAP-yJQWitk9ieF80imRky3PVsIs%2FX6A%3D" target="_blank" style="display:block;padding:12px;background-color:#eee;color:#666;margin-bottom:15px"><span style="font-weight:bold;color:#05a5d1">新架构实战课</span> <!-- -->实操 + 基建 + 原理全维度包揽，抢先掌握 React Native 新架构精髓<!-- --> <span style="border:solid 1px #666;padding:4px 6px;margin-left:8px;vertical-align:middle">立即查看 &gt;</span></a><div class="tocCollapsible_wXna theme-doc-toc-mobile tocMobile_Ojys"><button type="button" class="clean-btn tocCollapsibleButton_iI2p">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>内置 Hermes 引擎</h1></header><p>This page gives an overview of <strong>how</strong> Hermes and React Native <strong>are built</strong>.</p><p>If you&#x27;re looking into instructions on how to use Hermes in your app, you can find instructions on this other page: <a href="/docs/hermes">using Hermes</a></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_yySL"><p>Please note that this page serves as a technical deep dive and is targeted for users which are building extensions on top of Hermes or React Native. General users of React Native should not need to know in-depth information on how React Native and Hermes interact.</p></div></div><h2 class="anchor anchorWithStickyNavbar_JmGV" id="what-is-bundled-hermes">What is &#x27;Bundled Hermes&#x27;<a class="hash-link" href="#what-is-bundled-hermes" title="标题的直接链接">​</a></h2><p>Starting with React Native 0.69.0, every version of React Native will be <strong>built alongside</strong> to a Hermes version. We call this distribution model <strong>Bundled Hermes</strong>.</p><p>From 0.69 on, you will always have a JS engine that has been built and tested alongside each React Native version that you can use.</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="why-we-moved-to-bundled-hermes">Why we moved to &#x27;Bundled Hermes&#x27;<a class="hash-link" href="#why-we-moved-to-bundled-hermes" title="标题的直接链接">​</a></h2><p>Historically, React Native and Hermes followed two <strong>distinct release processes</strong> with distinct versioning. Having distinct releases with distinct numbers created confusion in the OSS ecosystem, where it was not clear if a specific version of Hermes was compatible with a specific version of React Native (i.e. you needed to know that Hermes 0.11.0 was compatible only with React Native 0.68.0, etc.)</p><p>Both Hermes and React Native, share the JSI code (<a href="https://github.com/facebook/hermes/tree/main/API/jsi/jsi" target="_blank" rel="noopener noreferrer">Hermes here</a> and <a href="https://github.com/facebook/react-native/tree/main/ReactCommon/jsi/jsi" target="_blank" rel="noopener noreferrer">React Native here</a>). If the two JSI copies of JSI get out of sync, a build of Hermes won&#x27;t be compatible with a build of React Native. You can read more about this <a href="https://github.com/react-native-community/discussions-and-proposals/issues/257" target="_blank" rel="noopener noreferrer">ABI incompatibility problem here</a>.</p><p>To overcome this problem, we&#x27;ve extended the React Native release process to download and build Hermes and made sure only one copy of JSI is used when building Hermes.</p><p>Thanks to this, we can release a version of Hermes whenever we release a version of React Native, and be sure that the Hermes engine we built is <strong>fully compatible</strong> with the React Native version we&#x27;re releasing. We&#x27;re shipping this version of Hermes alongside the React Native version we&#x27;re doing, hence the name <em>Bundled Hermes</em>.</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="how-this-will-impact-app-developers">How this will impact app developers<a class="hash-link" href="#how-this-will-impact-app-developers" title="标题的直接链接">​</a></h2><p>As mentioned in the introduction, if you&#x27;re an app developer, this change <strong>should not affect</strong> you directly.</p><p>The following paragraphs describe which changes we did under the hood and explains some of the rationales, for the sake of transparency.</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="ios-users">iOS Users<a class="hash-link" href="#ios-users" title="标题的直接链接">​</a></h3><p>On iOS, we&#x27;ve moved the <code>hermes-engine</code> you&#x27;re using.</p><p>Prior to React Native 0.69, users would download a pod (here you can find the <a href="https://github.com/CocoaPods/Specs/blob/master/Specs/5/d/0/hermes-engine/0.11.0/hermes-engine.podspec.json" target="_blank" rel="noopener noreferrer">podspec</a>).</p><p>On React Native 0.69, users would instead use a podspec that is defined inside the <code>sdks/hermes-engine/hermes-engine.podspec</code> file in the <code>react-native</code> NPM package.
That podspec relies on a pre-built tarball of Hermes that we upload on GitHub Releases, as part of the React Native release process (i.e. <a href="https://github.com/facebook/react-native/releases/tag/v0.69.0-rc.6" target="_blank" rel="noopener noreferrer">see the assets of this release</a>).</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="android-users">Android Users<a class="hash-link" href="#android-users" title="标题的直接链接">​</a></h3><p>On Android, we&#x27;re going to update the <a href="https://github.com/facebook/react-native/blob/main/template/android/app/build.gradle" target="_blank" rel="noopener noreferrer"><code>android/app/build.gradle</code></a> file in the default template the following way:</p><div class="language-diff codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#FFFFFF;--prism-background-color:#282C34"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-diff codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#FFFFFF"><span class="token plain">dependencies {</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   // ...</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   if (enableHermes) {</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:#859900">+</span><span class="token inserted-sign inserted line" style="color:#859900">       implementation(&quot;com.facebook.react:hermes-engine:+&quot;) {</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token inserted-sign inserted line" style="color:#859900"></span><span class="token inserted-sign inserted prefix inserted" style="color:#859900">+</span><span class="token inserted-sign inserted line" style="color:#859900">           exclude group:&#x27;com.facebook.fbjni&#x27;</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token inserted-sign inserted line" style="color:#859900"></span><span class="token inserted-sign inserted prefix inserted" style="color:#859900">+</span><span class="token inserted-sign inserted line" style="color:#859900">       }</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token inserted-sign inserted line" style="color:#859900"></span><span class="token deleted-sign deleted prefix deleted" style="color:#cb4b16">-</span><span class="token deleted-sign deleted line" style="color:#cb4b16">       def hermesPath = &quot;../../node_modules/hermes-engine/android/&quot;;</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token deleted-sign deleted line" style="color:#cb4b16"></span><span class="token deleted-sign deleted prefix deleted" style="color:#cb4b16">-</span><span class="token deleted-sign deleted line" style="color:#cb4b16">       debugImplementation files(hermesPath + &quot;hermes-debug.aar&quot;)</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token deleted-sign deleted line" style="color:#cb4b16"></span><span class="token deleted-sign deleted prefix deleted" style="color:#cb4b16">-</span><span class="token deleted-sign deleted line" style="color:#cb4b16">       releaseImplementation files(hermesPath + &quot;hermes-release.aar&quot;)</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token deleted-sign deleted line" style="color:#cb4b16"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   } else {</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       implementation jscFlavor</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   }</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token unchanged line"></span><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg class="copyButtonIcon_FoOz" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_L0B6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Prior to React Native 0.69, users will be consuming <code>hermes-debug.aar</code> and <code>hermes-release.aar</code> from the <code>hermes-engine</code> NPM package.</p><p>On React Native 0.69, users will be consuming the Android multi-variant artifacts available inside the <code>android/com/facebook/react/hermes-engine/</code> folder in the <code>react-native</code> NPM package.
Please also note that we&#x27;re going to <a href="https://github.com/facebook/react-native/blob/c418bf4c8fe8bf97273e3a64211eaa38d836e0a0/package.json#L105" target="_blank" rel="noopener noreferrer">remove the dependency</a> on <code>hermes-engine</code> entirely in one of the future version of React Native.</p><h4 class="anchor anchorWithStickyNavbar_JmGV" id="android-users-on-new-architecture">Android Users on New Architecture<a class="hash-link" href="#android-users-on-new-architecture" title="标题的直接链接">​</a></h4><p>Due to the nature of our native code build setup (i.e. how we use the NDK), users on the New Architecture will be <strong>building Hermes from source</strong>.</p><p>This aligns the build mechanism of React Native and Hermes for users on the New Architecture (they will build both framework from source).
This means that such Android users might experience a performance hit at build time on their first build.</p><p>You can find instructions to optimize your build time and reduce the impact on your build on this page: <a href="/docs/next/build-speed">Speeding up your Build phase</a>.</p><h4 class="anchor anchorWithStickyNavbar_JmGV" id="android-users-on-new-architecture-building-on-windows">Android Users on New Architecture building on Windows<a class="hash-link" href="#android-users-on-new-architecture-building-on-windows" title="标题的直接链接">​</a></h4><p>Users building React Native App, with the New Architecture, on Windows machines need to follow those extra steps to let the build work correctly:</p><ul><li>Make sure the <a href="https://reactnative.dev/docs/environment-setup" target="_blank" rel="noopener noreferrer">environment is configured properly</a>, with Android SDK &amp; node.</li><li>Install <a href="https://community.chocolatey.org/packages/cmake" target="_blank" rel="noopener noreferrer">cmake</a> with Chocolatey</li><li>Install either:<ul><li><a href="https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2022" target="_blank" rel="noopener noreferrer">Build Tools for Visual Studio 2022</a>.</li><li><a href="https://visualstudio.microsoft.com/vs/community/" target="_blank" rel="noopener noreferrer">Visual Studio 22 Community Edition</a> - Picking only the C++ desktop development is sufficient.</li></ul></li><li>Make sure the <a href="https://docs.microsoft.com/en-us/visualstudio/ide/reference/command-prompt-powershell?view=vs-2022" target="_blank" rel="noopener noreferrer">Visual Studio Command Prompt</a> is configured correctly. This is required as the proper C++ compiler environment variable is configured in those command prompt.</li><li>Run the app with <code>npx react-native run-android</code> inside a Visual Studio Command Prompt.</li></ul><h3 class="anchor anchorWithStickyNavbar_JmGV" id="can-users-still-use-another-engine">Can users still use another engine?<a class="hash-link" href="#can-users-still-use-another-engine" title="标题的直接链接">​</a></h3><p>Yes, users are free to enable/disable Hermes (with the <code>enableHermes</code> variable on Android, <code>hermes_enabled</code> on iOS).
The &#x27;Bundled Hermes&#x27; change will impact only <strong>how Hermes is built and bundled</strong> for you.</p><p>Please note that, at the time of writing, the default for <code>enableHermes</code>/<code>hermes_enabled</code> is <code>false</code>.
We&#x27;re looking into updating the template to have it default to <code>true</code> in the near future.</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="how-this-will-impact-contributor-and-extension-developers">How this will impact contributor and extension developers<a class="hash-link" href="#how-this-will-impact-contributor-and-extension-developers" title="标题的直接链接">​</a></h2><p>If you&#x27;re a React Native contributor or you&#x27;re building an extension on top of React Native or Hermes, please read further as we explain how Bundled Hermes works.</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="how-is-bundled-hermes-working-under-the-hood">How is Bundled Hermes working under the hood?<a class="hash-link" href="#how-is-bundled-hermes-working-under-the-hood" title="标题的直接链接">​</a></h3><p>This mechanism relies on <strong>downloading a tarball</strong> with the Hermes source code from the <code>facebook/hermes</code> repository inside the <code>facebook/react-native</code> repository. We have a similar mechanism in place for other native dependencies (Folly, Glog, etc.) and we aligned Hermes to follow the same setup.</p><p>When building React Native from <code>main</code>, we will be fetching a tarball of <code>main</code> of facebook/hermes and building it as part of the build process of React Native.</p><p>When building React Native from a release branch (say <code>0.69-stable</code>), we will instead use a <strong>tag</strong> on the Hermes repo to <strong>syncronize the code</strong> between the two repos. The specific tag name used will then be stored inside the <code>sdks/.hermesversion</code> file inside React Native in the release branch (e.g. <a href="https://github.com/facebook/react-native/blob/0.69-stable/sdks/.hermesversion" target="_blank" rel="noopener noreferrer">this is the file</a> on the 0.69 release branch).</p><p>In a sense, you can think of this approach similarly to a <strong>git submodule</strong>.</p><p>If you&#x27;re building on top of Hermes, you can rely on those tags to understand which version of Hermes was used when building React Native, as the version of React Native is specified in the tag name (e.g. <code>hermes-2022-05-20-RNv0.69.0-ee8941b8874132b8f83e4486b63ed5c19fc3f111</code>).</p><h4 class="anchor anchorWithStickyNavbar_JmGV" id="android-implementation-details">Android implementation details<a class="hash-link" href="#android-implementation-details" title="标题的直接链接">​</a></h4><p>To implement this on Android, we&#x27;ve added a new build inside the <code>/ReactAndroid/hermes-engine</code> of React Native that will take care of building Hermes and packaging for consumption ((See here for more context)<!-- -->[https://github.com/facebook/react-native/pull/33396]<!-- -->).</p><p>You can now trigger a build of Hermes engine by invoking:</p><div class="language-bash codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#FFFFFF;--prism-background-color:#282C34"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-bash codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#FFFFFF"><span class="token plain">// Build a debug version of Hermes</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token plain">./gradlew :ReactAndroid:hermes-engine:assembleDebug</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token plain">// Build a release version of Hermes</span><br></span><span class="token-line" style="color:#FFFFFF"><span class="token plain">./gradlew :ReactAndroid:hermes-engine:assembleRelease</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg class="copyButtonIcon_FoOz" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_L0B6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>from the React Native <code>main</code> branch.</p><p>You won&#x27;t need to install extra tools (such as <code>cmake</code>, <code>ninja</code> or <code>python3</code>) in your machine as we configured the build to use the NDK versions of those tools.</p><p>On the Gradle consumer side, we also shipped a small improvement on the consumer side: we moved from <code>releaseImplementation</code> &amp; <code>debugImplementation</code> to <code>implementation</code>. This is possible because the newer <code>hermes-engine</code> Android artifact is <strong>variant aware</strong> and will properly match a debug build of the engine with a debug build of your app. You don&#x27;t need any custom configuration here (even if you use <code>staging</code> or other build types/flavors).</p><p>However, this made this line necessary in the template:</p><div class="language-jsx codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#FFFFFF;--prism-background-color:#282C34"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-jsx codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#FFFFFF"><span class="token plain">exclude group</span><span class="token operator" style="color:#fc929e">:</span><span class="token string" style="color:#8dc891">&#x27;com.facebook.fbjni&#x27;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg class="copyButtonIcon_FoOz" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_L0B6" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is needed as React Native is consuming <code>fbjni</code> using the non-prefab approach (i.e. unzipping the <code>.aar</code> and extracting <code>.so</code> files). Hermes-engine, and other libraries, are using prefab instead to consume fbjni. We&#x27;re looking into <a href="https://github.com/facebook/react-native/pull/33397" target="_blank" rel="noopener noreferrer">addressing this issue</a> in the future so the Hermes import will be a oneliner.</p><h4 class="anchor anchorWithStickyNavbar_JmGV" id="ios-implementation-details">iOS implementation details<a class="hash-link" href="#ios-implementation-details" title="标题的直接链接">​</a></h4><p>The iOS implementation relies on a series of scripts that lives in the following locations:</p><ul><li><a href="https://github.com/facebook/react-native/tree/main/scripts/hermes" target="_blank" rel="noopener noreferrer"><code>/scripts/hermes</code></a>. Those scripts contain logic to download the hermes tarball, unzip it, and configure the iOS build. They&#x27;re invoked at <code>pod install</code> time if you have the <code>hermes_enabled</code> field set to <code>true</code>.</li><li><a href="https://github.com/facebook/react-native/tree/main/sdks/hermes-engine" target="_blank" rel="noopener noreferrer"><code>/sdks/hermes-engine</code></a>. Those scripts contain the build logic that is effectively building Hermes. They were copied and adapted from the <code>facebook/hermes</code> repo to properly work within React Native. Specifically, the scripts inside the <code>utils</code> folder are responsible of building Hermes for all the Mac platforms.</li></ul><p>To distribute a prebuilt for iOS, we rely on the <code>build_hermes_macos</code> Job on CircleCI. The job will produce as artifact a tarball which will be downloaded by the <code>hermes-engine</code> podspec (i.e. <a href="https://app.circleci.com/pipelines/github/facebook/react-native/13679/workflows/5172f8e4-6b02-4ccb-ab97-7cb954911fae/jobs/258701/artifacts" target="_blank" rel="noopener noreferrer">those are the artifacts for an execution for React Native 0.69</a>).</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="im-afraid-this-change-is-impacting-me">I&#x27;m afraid this change is impacting me<a class="hash-link" href="#im-afraid-this-change-is-impacting-me" title="标题的直接链接">​</a></h3><p>We&#x27;d like to stress that this is essentially an organizational change on <em>where</em> Hermes is built and <em>how</em> the code is syncronized between the two repositories. The change should be fully transparent to our users.</p><p>Historically, we used to cut a release of Hermes for a specific version of React Native (e.g. <a href="https://github.com/facebook/hermes/releases/tag/v0.11.0" target="_blank" rel="noopener noreferrer"><code>v0.11.0 for RN0.68.x</code></a>).</p><p>With &#x27;Bundled Hermes&#x27;, you can instead rely on a tag that will represent the version used when a specific version of React Native was cut.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/reactnativecn/react-native-website/blob/production/cnwebsite/architecture/bundled-hermes.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bHB7" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>改进此文档</a></div><div class="col lastUpdated_pbO5"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/architecture/threading-model"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">线程模型</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/architecture/glossary"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">术语表</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-bundled-hermes" class="table-of-contents__link toc-highlight">What is &#39;Bundled Hermes&#39;</a></li><li><a href="#why-we-moved-to-bundled-hermes" class="table-of-contents__link toc-highlight">Why we moved to &#39;Bundled Hermes&#39;</a></li><li><a href="#how-this-will-impact-app-developers" class="table-of-contents__link toc-highlight">How this will impact app developers</a><ul><li><a href="#ios-users" class="table-of-contents__link toc-highlight">iOS Users</a></li><li><a href="#android-users" class="table-of-contents__link toc-highlight">Android Users</a></li><li><a href="#can-users-still-use-another-engine" class="table-of-contents__link toc-highlight">Can users still use another engine?</a></li></ul></li><li><a href="#how-this-will-impact-contributor-and-extension-developers" class="table-of-contents__link toc-highlight">How this will impact contributor and extension developers</a><ul><li><a href="#how-is-bundled-hermes-working-under-the-hood" class="table-of-contents__link toc-highlight">How is Bundled Hermes working under the hood?</a></li><li><a href="#im-afraid-this-change-is-impacting-me" class="table-of-contents__link toc-highlight">I&#39;m afraid this change is impacting me</a></li></ul></li></ul><div class="wwads-cn wwads-vertical" data-id="58" style="max-width:200px;margin-top:20px"></div> </div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">React Native 中文网 © 2022 武汉青罗网络科技有限公司
      <a style="margin-left:10px" href="http://beian.miit.gov.cn/">鄂ICP备20002031号-3</a>
      <img style="width:25px" src="//img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png" alt="鄂公网安备 42011202001821号">
      <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42011202001821">鄂公网安备 42011202001821号</a>
      </div></div></div></footer></div>
<script src="/assets/js/runtime~main.eab225d6.js"></script>
<script src="/assets/js/main.dee7dd97.js"></script>
</body>
</html>